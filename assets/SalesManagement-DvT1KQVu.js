import{c as he,j as e,C as M,f as G,g as L,D as Ce,h as z,i as xe,U as De,q as Ae,r as u,t as re,s as g,l as le,S as K,a as X,b as W,d as Q,e as Z,v as Ne,w as ye,x as w,y as be,z as _e,A as Se,E as we,F as Re,L as T,I as P,G as Ee,H as pe,J as Fe,K as Be,M as ve,N as U,O as Me,Q as H,V as B,k as ze,W as Ie,X as Ye,Y as Te,Z as $e,_ as ke,$ as qe,a0 as oe,B as Ge,T as Le,R as Oe,m as Pe,n as ge,a1 as Ve,a2 as Je,a3 as de,a4 as me}from"./index-QmxZ3gqB.js";import{B as Ue,C as He,X as Ke,Y as Xe}from"./BarChart-DkYFM_FY.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=he("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=he("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=he("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function ea(){const f=R=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(R),n=new Date().getFullYear();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sistema de GestÃ£o de Vendas"}),e.jsx("p",{className:"text-muted-foreground",children:"Painel interativo para gerenciamento de vendas, metas e simulaÃ§Ãµes de crescimento"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(M,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(L,{className:"text-sm font-medium",children:["Total Vendido ",n]}),e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(z,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f(85e4)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Acumulado atÃ© ",new Date().toLocaleDateString("pt-BR",{month:"long"})]})]})]}),e.jsxs(M,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Crescimento Acumulado"}),e.jsx(xe,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(z,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+",12.5.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs ano anterior"})]})]}),e.jsxs(M,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Vendedoras Ativas"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(z,{children:[e.jsx("div",{className:"text-2xl font-bold",children:8}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Ãšltima atualizaÃ§Ã£o: ",new Date().toLocaleString("pt-BR")]})]})]})]})]})}const aa=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];async function sa(){const{data:f,error:n}=await g.from("entidades_corporativas").select("id").order("created_at",{ascending:!0});return n?(console.error("Erro ao buscar entidades_corporativas:",n.message),null):!f||f.length===0?null:f[0].id}function je(){const{user:f}=Ae(),[n,_]=u.useState(!0),[x,I]=u.useState(new Date().getFullYear()),[R,A]=u.useState(null),[D,p]=u.useState([]),[$,N]=u.useState([]),E=u.useCallback(async()=>{const t=await sa();return A(t),t},[f==null?void 0:f.id]),y=u.useMemo(()=>!!R,[R]),b=u.useCallback(async()=>{_(!0);try{const t=await E();if(!t){p([]),N([]),re({title:"Nenhuma Entidade Encontrada",description:"Configure pelo menos uma entidade corporativa no sistema para usar o mÃ³dulo de vendas.",variant:"destructive"});return}const d=[x,x-1,x-2],{data:h,error:i}=await g.from("store_monthly_sales").select("*").eq("entity_id",t).in("year",d);if(i)throw i;const s=aa.map((a,r)=>{const j=r+1,S={month:j,monthName:a,years:{}};return d.forEach(v=>{const l=h==null?void 0:h.find(k=>k.year===v&&k.month===j);S.years[v]=l?Number(l.total_sales):""}),S});p(s);const{data:m,error:c}=await g.rpc("get_pessoas_with_papeis");let ee=[];if(c){console.warn("Erro ao buscar pessoas com papÃ©is:",c);const{data:a,error:r}=await g.from("pessoas").select("id, nome, ativo, cpf_cnpj_normalizado, eh_vendedora").eq("ativo",!0).eq("eh_vendedora",!0);if(r)throw r;ee=(a||[]).map(j=>({...j,source:"pessoas",eh_vendedora:!0}))}else ee=(m||[]).filter(a=>a.papeis&&a.papeis.includes("vendedora")).map(a=>({...a,source:"pessoas",eh_vendedora:!0}));const{data:ie,error:te}=await g.from("sales_goals").select("salesperson_id, month, goal_amount").eq("entity_id",t).eq("year",x);if(te)throw te;const{data:ce,error:ne}=await g.from("salesperson_sales").select("salesperson_id, month, sales_amount").eq("entity_id",t).eq("year",x);if(ne)throw ne;const ae=new Map;for(const a of ie??[]){const r=a.salesperson_id,j=Number(a.month),S=Number(a.goal_amount??0),v=ae.get(r)??{};v[j]=S,ae.set(r,v)}const se=new Map;for(const a of ce??[]){const r=a.salesperson_id,j=Number(a.month),S=Number(a.sales_amount??0),v=se.get(r)??{};v[j]=S,se.set(r,v)}const V=new Map;(ee??[]).forEach(a=>{const r=`${(a.nome||"").trim().toUpperCase()}-${a.cpf_cnpj_normalizado||""}`;V.has(r)||V.set(r,a)});const J=Array.from(V.values()).map(a=>({salesperson_id:a.id,salesperson_name:a.nome,monthly_goals:ae.get(a.id)??{},monthly_sales:se.get(a.id)??{}}));N(J)}catch(t){console.error("Erro ao buscar dados:",t),re({title:"Falha ao carregar",description:t.message??String(t),variant:"destructive"})}finally{_(!1)}},[E,x]);return u.useEffect(()=>{b()},[b]),{loading:n,currentYear:x,setCurrentYear:I,yearlyData:D,updateYearlySale:(t,d,h)=>{p(i=>i.map(s=>s.month===t?{...s,years:{...s.years,[d]:h===""?"":Number(h)}}:s))},salespersonData:$,updateSalespersonGoal:(t,d,h)=>{N(i=>i.map(s=>s.salesperson_id===t?{...s,monthly_goals:{...s.monthly_goals,[d]:h===""?"":Number(h)}}:s))},updateSalespersonSales:(t,d,h)=>{N(i=>i.map(s=>s.salesperson_id===t?{...s,monthly_sales:{...s.monthly_sales,[d]:h===""?"":Number(h)}}:s))},saveAllData:async()=>{const t=R;if(!t){re({title:"Entidade NÃ£o Configurada",description:"Configure uma entidade corporativa no sistema primeiro.",variant:"destructive"});return}_(!0);try{const d=[];if(D.forEach(s=>{Object.entries(s.years).forEach(([m,c])=>{c!==""&&c!==null&&!Number.isNaN(Number(c))&&d.push({entity_id:t,year:Number(m),month:s.month,total_sales:Number(c)})})}),d.length){const{error:s}=await g.from("store_monthly_sales").upsert(d,{onConflict:"entity_id, year, month"});if(s)throw s}const h=[];if($.forEach(s=>{Object.entries(s.monthly_goals).forEach(([m,c])=>{c!==""&&c!==null&&!Number.isNaN(Number(c))&&h.push({entity_id:t,salesperson_id:s.salesperson_id,year:x,month:Number(m),goal_amount:Number(c)})})}),h.length){const{error:s}=await g.from("sales_goals").upsert(h,{onConflict:"salesperson_id, entity_id, year, month"});if(s)throw s}const i=[];if($.forEach(s=>{Object.entries(s.monthly_sales).forEach(([m,c])=>{c!==""&&c!==null&&!Number.isNaN(Number(c))&&i.push({entity_id:t,salesperson_id:s.salesperson_id,year:x,month:Number(m),sales_amount:Number(c)})})}),i.length){const{error:s}=await g.from("salesperson_sales").upsert(i,{onConflict:"entity_id, salesperson_id, year, month"});if(s)throw s}re({title:"Salvo!",description:"Vendas e metas persistidas no Supabase."})}catch(d){console.error("Erro ao salvar:",d),re({title:"Falha ao salvar",description:d.message??String(d),variant:"destructive"})}finally{_(!1)}},hasEntity:y,refreshData:b}}function ra(){const{loading:f,currentYear:n,setCurrentYear:_,yearlyData:x,updateYearlySale:I,saveAllData:R,hasEntity:A}=je(),[D,p]=u.useState(new Date().getFullYear()+1),[$,N]=u.useState(!1),E=()=>{_(D),N(!1),B.success(`Ano ${D} selecionado para visualizaÃ§Ã£o!`)},y=()=>{if(!A){B.error("Nenhuma entidade configurada. Configure uma entidade corporativa primeiro.");return}R()};u.useEffect(()=>{const t=()=>y();return window.addEventListener("saveAllSalesData",t),()=>window.removeEventListener("saveAllSalesData",t)},[A]);const b=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),o=t=>t>0?e.jsx(xe,{className:"w-4 h-4 text-green-600"}):t<0?e.jsx(ze,{className:"w-4 h-4 text-red-600"}):e.jsx(We,{className:"w-4 h-4 text-muted-foreground"}),C=t=>t>0?"text-green-600":t<0?"text-red-600":"text-muted-foreground",Y=(t,d)=>!d||d===0?0:(t-d)/d*100,q=t=>t===0?"0%":`${t>0?"+":""}${t.toFixed(1)}%`;return e.jsx("div",{className:"space-y-6",children:e.jsxs(M,{children:[e.jsxs(G,{children:[e.jsx(L,{children:"ComparaÃ§Ã£o Anual de Vendas"}),e.jsx(le,{children:"HistÃ³rico de vendas mensais e crescimento ano a ano"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(K,{value:n.toString(),onValueChange:t=>_(parseInt(t)),children:[e.jsx(X,{className:"w-40",children:e.jsx(W,{})}),e.jsx(Q,{children:Array.from({length:5},(t,d)=>new Date().getFullYear()-d).map(t=>e.jsx(Z,{value:t.toString(),children:t},t))})]}),e.jsxs(Ne,{open:$,onOpenChange:N,children:[e.jsx(ye,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Adicionar Ano"]})}),e.jsxs(_e,{children:[e.jsxs(Se,{children:[e.jsx(we,{children:"Adicionar Novo Ano"}),e.jsx(Re,{children:"Adicione um novo ano para comparaÃ§Ã£o de vendas"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(T,{htmlFor:"new-year",children:"Ano"}),e.jsx(P,{id:"new-year",type:"number",value:D,onChange:t=>p(parseInt(t.target.value))})]})}),e.jsxs(Ee,{children:[e.jsx(w,{variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(w,{onClick:E,children:"Adicionar"})]})]})]})]}),e.jsxs(w,{size:"sm",onClick:y,disabled:f||!A,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Salvar AlteraÃ§Ãµes"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:[n,n-1,n-2].map(t=>{const d=x.filter(h=>h.years[t]&&typeof h.years[t]=="number").reduce((h,i)=>h+Number(i.years[t]),0);return e.jsx(M,{className:t===n?"ring-2 ring-primary":"",children:e.jsx(z,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t}),e.jsx("p",{className:"text-2xl font-bold",children:b(d)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-1",children:[o(0),e.jsx("span",{className:`text-sm font-medium ${C(0)}`,children:"+8.5%"})]})})]})})},t)})}),e.jsxs(M,{children:[e.jsx(G,{children:e.jsxs(L,{children:["Detalhamento Mensal - ",n]})}),e.jsx(z,{children:e.jsxs(Fe,{children:[e.jsx(Be,{children:e.jsxs(ve,{children:[e.jsx(U,{children:"MÃªs"}),e.jsx(U,{className:"text-right",children:n}),e.jsx(U,{className:"text-center",children:"Crescimento"}),e.jsx(U,{className:"text-right",children:n-1}),e.jsx(U,{className:"text-center",children:"Crescimento"}),e.jsx(U,{className:"text-right",children:n-2})]})}),e.jsx(Me,{children:x.map(t=>{const d=t.years[n]||0,h=t.years[n-1]||0,i=t.years[n-2]||0,s=Y(d,h),m=Y(h,i);return e.jsxs(ve,{children:[e.jsx(H,{className:"font-medium",children:t.monthName}),e.jsx(H,{className:"text-right",children:e.jsx(P,{type:"number",value:typeof t.years[n]=="number"?t.years[n]:"",onChange:c=>I(t.month,n,c.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})}),e.jsx(H,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o(s),e.jsx("span",{className:`text-sm font-medium ${C(s)}`,children:q(s)})]})}),e.jsx(H,{className:"text-right",children:e.jsx(P,{type:"number",value:typeof t.years[n-1]=="number"?t.years[n-1]:"",onChange:c=>I(t.month,n-1,c.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})}),e.jsx(H,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o(m),e.jsx("span",{className:`text-sm font-medium ${C(m)}`,children:q(m)})]})}),e.jsx(H,{className:"text-right",children:e.jsx(P,{type:"number",value:typeof t.years[n-2]=="number"?t.years[n-2]:"",onChange:c=>I(t.month,n-2,c.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})})]},t.month)})})]})})]})]})]})})}const ue=u.forwardRef(({value:f,onValueChange:n,min:_,max:x,step:I=1,decimals:R=0,className:A,placeholder:D="",...p},$)=>{const[N,E]=u.useState(!1),[y,b]=u.useState(""),o=i=>R>0?i.toFixed(R).replace(".",","):i.toString(),C=i=>{if(!i)return;const s=i.replace(",","."),m=parseFloat(s);return isNaN(m)?void 0:m},Y=i=>{let s=i;return _!==void 0&&s<_&&(s=_),x!==void 0&&s>x&&(s=x),s},q=i=>{const s=i.target.value;if(s===""){b(""),n==null||n(void 0);return}if(!(R>0?/^-?\d*[,.]?\d*$/:/^-?\d*$/).test(s))return;b(s);const c=C(s);c===void 0?n==null||n(void 0):n==null||n(c)},t=i=>{var s;if(E(!0),!y){const m=f!==void 0?o(f):"";b(m.replace(/\./g,","))}(s=p.onFocus)==null||s.call(p,i)},d=i=>{var m;E(!1);const s=C(y);if(s===void 0)b(""),n==null||n(void 0);else{const c=Y(s);n==null||n(c),b("")}(m=p.onBlur)==null||m.call(p,i)};Ie.useEffect(()=>{N||b("")},[N]);const h=N?y:f!==void 0?o(Y(f)):"";return e.jsx(P,{ref:$,type:"text",inputMode:R>0?"decimal":"numeric",value:h,onChange:q,onFocus:t,onBlur:d,placeholder:D,min:_,max:x,step:I,className:Ye("text-right",A),...p})});ue.displayName="NumberInput";function ta(){const{loading:f,currentYear:n,setCurrentYear:_,salespersonData:x,updateSalespersonGoal:I,updateSalespersonSales:R,saveAllData:A,hasEntity:D}=je(),[p,$]=u.useState(new Date().getMonth()+1),[N,E]=u.useState(!1),[y,b]=u.useState(null),[o,C]=u.useState([]),[Y,q]=u.useState(""),[t,d]=u.useState([]),[h,i]=u.useState({});u.useState([]);const[s,m]=u.useState({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),c=async()=>{try{const{data:a,error:r}=await g.from("fornecedores").select("id, nome, cpf, cnpj_cpf, email, telefone, salario, tipo_pessoa, cpf_cnpj_normalizado").eq("ativo",!0).order("nome");if(r)throw r;const{data:j,error:S}=await g.from("entidades_corporativas").select("id, nome_razao_social, cpf_cnpj, cpf_cnpj_normalizado, email, telefone, tipo_pessoa, ativo").eq("ativo",!0).order("nome_razao_social");if(S)throw S;const v=new Map;(a||[]).forEach(l=>{const k=l.tipo_pessoa==="pessoa_fisica"?l.cpf||"":l.cnpj_cpf||"",O=`${(l.nome||"").trim().toUpperCase()}-${(l.cpf_cnpj_normalizado||k||"").trim()}`;v.has(O)||v.set(O,{id:l.id||"",nome:l.nome||"",cpf:k||void 0,email:l.email||void 0,telefone:l.telefone||void 0,salario:l.salario?Number(l.salario):void 0})}),(j||[]).forEach(l=>{const k=l.cpf_cnpj||"",O=`${(l.nome_razao_social||"").trim().toUpperCase()}-${(l.cpf_cnpj_normalizado||k||"").trim()}`;v.has(O)||v.set(O,{id:`entidade:${l.id}`,nome:l.nome_razao_social||"",cpf:k||void 0,email:l.email||void 0,telefone:l.telefone||void 0,salario:void 0})}),C(Array.from(v.values()))}catch(a){console.error("Error loading existing employees:",a),B.error("Erro ao carregar funcionÃ¡rios/vendedoras")}};u.useEffect(()=>{c()},[]);const ee=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),ie=async()=>{if(!s.name.trim()){B.error("Nome Ã© obrigatÃ³rio!");return}try{if(Y)if(Y.startsWith("entidade:")){const a=Y.split(":")[1],{data:r,error:j}=await g.from("entidades_corporativas").select("id, nome_razao_social, cpf_cnpj, cpf_cnpj_normalizado, email, telefone, tipo_pessoa").eq("id",a).maybeSingle();if(j)throw j;const S=(r==null?void 0:r.cpf_cnpj_normalizado)||(r!=null&&r.cpf_cnpj?String(r.cpf_cnpj).replace(/\D/g,""):null);let v=null;if(S){const{data:l}=await g.from("fornecedores").select("id").eq("cpf_cnpj_normalizado",S).maybeSingle();v=(l==null?void 0:l.id)??null}if(v){const{error:l}=await g.from("fornecedores").update({eh_vendedora:!0,nome:s.name,salario:s.baseSalary??null,comissao_padrao:s.commissionRate!=null?s.commissionRate*100:null,comissao_supermeta:s.supermetaRate!=null?s.supermetaRate*100:null,meta_mensal:s.metaBase??null}).eq("id",v);if(l)throw l}else{const{error:l}=await g.from("fornecedores").insert([{nome:s.name||(r==null?void 0:r.nome_razao_social)||"",tipo_pessoa:(r==null?void 0:r.tipo_pessoa)||"pessoa_fisica",ativo:!0,eh_vendedora:!0,salario:s.baseSalary??null,comissao_padrao:s.commissionRate!=null?s.commissionRate*100:null,comissao_supermeta:s.supermetaRate!=null?s.supermetaRate*100:null,meta_mensal:s.metaBase??null,cnpj_cpf:(r==null?void 0:r.cpf_cnpj)||null,cpf_cnpj_normalizado:S||null,email:(r==null?void 0:r.email)||null,telefone:(r==null?void 0:r.telefone)||null}]);if(l)throw l}}else{const{error:a}=await g.from("fornecedores").update({eh_vendedora:!0,nome:s.name,salario:s.baseSalary??null,comissao_padrao:s.commissionRate!=null?s.commissionRate*100:null,comissao_supermeta:s.supermetaRate!=null?s.supermetaRate*100:null,meta_mensal:s.metaBase??null}).eq("id",Y);if(a)throw a}else{const{error:a}=await g.from("fornecedores").insert([{nome:s.name,tipo_pessoa:"pessoa_fisica",ativo:!0,eh_vendedora:!0,salario:s.baseSalary??null,comissao_padrao:s.commissionRate!=null?s.commissionRate*100:null,comissao_supermeta:s.supermetaRate!=null?s.supermetaRate*100:null,meta_mensal:s.metaBase??null}]);if(a)throw a}await c(),await c(),m({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),q(""),E(!1),B.success("Vendedora adicionada com sucesso!")}catch(a){console.error("Erro ao adicionar vendedora:",a),B.error((a==null?void 0:a.message)||"Falha ao adicionar vendedora")}},te=async a=>{try{const{data:r,error:j}=await g.from("fornecedores").select("id, nome, salario, comissao_padrao, comissao_supermeta, meta_mensal").eq("id",a.id).single();if(j)throw j;b({id:r.id,name:r.nome,baseSalary:Number(r.salario||0),commissionRate:Number(r.comissao_padrao||0)/100,metaBase:Number(r.meta_mensal||0),supermetaRate:Number(r.comissao_supermeta||0)/100}),m({name:r.nome||"",baseSalary:r.salario?Number(r.salario):void 0,commissionRate:r.comissao_padrao!=null?Number(r.comissao_padrao)/100:void 0,metaBase:r.meta_mensal?Number(r.meta_mensal):void 0,supermetaRate:r.comissao_supermeta!=null?Number(r.comissao_supermeta)/100:void 0})}catch(r){console.error("Erro ao carregar vendedora:",r),B.error("NÃ£o foi possÃ­vel carregar os dados da vendedora")}},ce=async()=>{if(!y||!s.name.trim()){B.error("Nome Ã© obrigatÃ³rio!");return}try{const{error:a}=await g.from("fornecedores").update({nome:s.name,salario:s.baseSalary??null,comissao_padrao:s.commissionRate!=null?s.commissionRate*100:null,comissao_supermeta:s.supermetaRate!=null?s.supermetaRate*100:null,meta_mensal:s.metaBase??null}).eq("id",y.id);if(a)throw a;i(r=>({...r,[y.id]:s.name})),b(null),m({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),B.success("Vendedora atualizada com sucesso!")}catch(a){console.error("Erro ao salvar vendedora:",a),B.error("Falha ao salvar alteraÃ§Ãµes")}},ne=async a=>{try{const{error:r}=await g.from("fornecedores").update({eh_vendedora:!1}).eq("id",a);if(r)throw r;d(j=>[...j,a]),B.success("Vendedora removida do painel!")}catch(r){console.error("Erro ao remover vendedora:",r),B.error("NÃ£o foi possÃ­vel remover")}},ae=(a,r)=>{I(a,p,r)},se=(a,r)=>{R(a,p,r)},V=()=>{if(!D){B.error("Nenhuma entidade configurada. Configure uma entidade corporativa primeiro.");return}A()};u.useEffect(()=>{const a=()=>V();return window.addEventListener("saveAllSalesData",a),()=>window.removeEventListener("saveAllSalesData",a)},[D]);const fe=a=>{const r=o.find(j=>j.id===a);r&&m(j=>({...j,name:r.nome,baseSalary:r.salario||void 0}))},J=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"MarÃ§o"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs(M,{children:[e.jsxs(G,{children:[e.jsx(L,{children:"Painel de Vendedoras"}),e.jsx(le,{children:"Gerencie informaÃ§Ãµes das vendedoras, metas e comissÃµes"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(K,{value:p.toString(),onValueChange:a=>$(parseInt(a)),children:[e.jsx(X,{className:"w-40",children:e.jsx(W,{})}),e.jsx(Q,{children:J.map(a=>e.jsx(Z,{value:a.value.toString(),children:a.label},a.value))})]}),e.jsxs(K,{value:n.toString(),onValueChange:a=>_(parseInt(a)),children:[e.jsx(X,{className:"w-32",children:e.jsx(W,{})}),e.jsx(Q,{children:Array.from({length:5},(a,r)=>new Date().getFullYear()-r).map(a=>e.jsx(Z,{value:a.toString(),children:a},a))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Importar"]}),e.jsxs(w,{variant:"outline",size:"sm",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(w,{size:"sm",onClick:V,disabled:f||!D,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Salvar"]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:x&&x.length>0?x.filter(a=>!t.includes(a.salesperson_id)).map(a=>{var v,l,k,O;const r=a.monthly_goals[p]||"",j=typeof r=="number"&&r>0?50:0,S=h[a.salesperson_id]??a.salesperson_name;return e.jsxs(M,{children:[e.jsx(G,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-lg",children:S}),e.jsxs(le,{children:["Meta ",(v=J.find(F=>F.value===p))==null?void 0:v.label,": ",typeof r=="number"?ee(r):"NÃ£o definida"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>te({id:a.salesperson_id,name:S,baseSalary:0,commissionRate:.03,metaBase:0,supermetaRate:.05}),children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>{confirm(`Tem certeza que deseja remover ${S}?`)&&ne(a.salesperson_id)},children:e.jsx(qe,{className:"w-4 h-4"})})]})]})}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsxs(T,{htmlFor:`goal-${a.salesperson_id}`,className:"text-sm",children:["Meta Mensal - ",(l=J.find(F=>F.value===p))==null?void 0:l.label]}),e.jsx(oe,{value:typeof r=="number"?r:void 0,onValueChange:F=>ae(a.salesperson_id,(F==null?void 0:F.toString())||""),placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsxs(T,{htmlFor:`sales-${a.salesperson_id}`,className:"text-sm",children:["Vendas Realizadas - ",(k=J.find(F=>F.value===p))==null?void 0:k.label]}),e.jsx(oe,{value:((O=a.monthly_sales)==null?void 0:O[p])||void 0,onValueChange:F=>se(a.salesperson_id,(F==null?void 0:F.toString())||""),placeholder:"R$ 0,00"})]})]}),e.jsx("div",{className:"flex justify-between items-center pt-2",children:e.jsxs(Ge,{variant:j>=100?"default":"secondary",children:[e.jsx(Le,{className:"w-3 h-3 mr-1"}),"Meta definida"]})})]})]},a.salesperson_id)}):e.jsx("div",{className:"col-span-full text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:f?"Carregando vendedoras...":"Nenhuma vendedora encontrada. Adicione vendedoras usando o botÃ£o abaixo."})})}),e.jsxs(Ne,{open:N||!!y,onOpenChange:a=>{a||(E(!1),b(null),m({name:"",baseSalary:2e3,commissionRate:.03,metaBase:15e3,supermetaRate:.05}))},children:[e.jsx(ye,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:"w-full",onClick:()=>E(!0),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Adicionar Nova Vendedora"]})}),e.jsxs(_e,{children:[e.jsxs(Se,{children:[e.jsx(we,{children:y?"Editar Vendedora":"Adicionar Nova Vendedora"}),e.jsx(Re,{children:"Preencha os dados da vendedora"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"existing",children:"Selecionar FuncionÃ¡rio/Vendedora Existente"}),e.jsxs(K,{value:Y,onValueChange:a=>{q(a),fe(a)},children:[e.jsx(X,{children:e.jsx(W,{placeholder:"Escolher do cadastro existente (opcional)"})}),e.jsx(Q,{children:o.map((a,r)=>e.jsxs(Z,{value:a.id,children:[a.nome," ",a.cpf?`(${a.cpf})`:""]},`${a.id}-${r}`))})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"name",children:"Nome"}),e.jsx(P,{id:"name",value:s.name,onChange:a=>m(r=>({...r,name:a.target.value})),placeholder:"Digite o nome"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"baseSalary",children:"SalÃ¡rio Base"}),e.jsx(oe,{value:s.baseSalary,onValueChange:a=>m(r=>({...r,baseSalary:a})),placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"metaBase",children:"Meta Base"}),e.jsx(oe,{value:s.metaBase,onValueChange:a=>m(r=>({...r,metaBase:a})),placeholder:"R$ 0,00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"commissionRate",children:"ComissÃ£o Base (%)"}),e.jsx(ue,{value:s.commissionRate?s.commissionRate*100:void 0,onValueChange:a=>m(r=>({...r,commissionRate:a?a/100:void 0})),decimals:2,min:0,max:100,placeholder:"Ex: 3.50"})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"supermetaRate",children:"Super Meta (%)"}),e.jsx(ue,{value:s.supermetaRate?s.supermetaRate*100:void 0,onValueChange:a=>m(r=>({...r,supermetaRate:a?a/100:void 0})),decimals:2,min:0,max:100,placeholder:"Ex: 5.00"})]})]})]}),e.jsxs(Ee,{children:[e.jsx(w,{variant:"outline",onClick:()=>{E(!1),b(null),q("")},children:"Cancelar"}),e.jsx(w,{onClick:y?ce:ie,children:y?"Salvar":"Adicionar"})]})]})]})]})]})})}function na(){const[f,n]=u.useState(new Date().getFullYear()),[_,x]=u.useState(new Date().getMonth()+1),[I,R]=u.useState(5),[A]=u.useState([{month:"Jan",current:45e3,projected:47250},{month:"Fev",current:52e3,projected:54600},{month:"Mar",current:48e3,projected:50400},{month:"Abr",current:55e3,projected:57750},{month:"Mai",current:6e4,projected:63e3},{month:"Jun",current:58e3,projected:60900}]),D=new Date().getFullYear(),p=Array.from({length:5},(o,C)=>D-2+C),$=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"MarÃ§o"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}],N=o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(o),E=A.reduce((o,C)=>o+C.current,0),y=A.reduce((o,C)=>o+C.projected,0),b=(y-E)/E*100;return e.jsx("div",{className:"space-y-6",children:e.jsxs(M,{children:[e.jsxs(G,{children:[e.jsx(L,{children:"SimulaÃ§Ã£o de Crescimento"}),e.jsx(le,{children:"Projete cenÃ¡rios de crescimento baseados em dados histÃ³ricos"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(T,{htmlFor:"base-year",children:"Ano Base"}),e.jsxs(K,{value:f.toString(),onValueChange:o=>n(parseInt(o)),children:[e.jsx(X,{id:"base-year",children:e.jsx(W,{})}),e.jsx(Q,{children:p.map(o=>e.jsx(Z,{value:o.toString(),children:o},o))})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"base-month",children:"MÃªs Base"}),e.jsxs(K,{value:_.toString(),onValueChange:o=>x(parseInt(o)),children:[e.jsx(X,{id:"base-month",children:e.jsx(W,{})}),e.jsx(Q,{children:$.map(o=>e.jsx(Z,{value:o.value.toString(),children:o.label},o.value))})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:"growth-rate",children:"Taxa de Crescimento (%)"}),e.jsx(P,{id:"growth-rate",type:"number",value:I,onChange:o=>R(Number(o.target.value)),step:"0.1",min:"0",max:"100"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs(w,{className:"flex-1",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Simular"]}),e.jsx(w,{variant:"outline",size:"icon",children:e.jsx(Ze,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(M,{children:e.jsxs(z,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:N(E)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vendas Atuais"})]})}),e.jsx(M,{children:e.jsxs(z,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:N(y)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ProjeÃ§Ã£o com Crescimento"})]})}),e.jsx(M,{children:e.jsxs(z,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+",b.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Crescimento Projetado"})]})})]}),e.jsxs(M,{children:[e.jsx(G,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"ComparaÃ§Ã£o: Atual vs Projetado"]})}),e.jsx(z,{children:e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(Ue,{data:A,children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"month"}),e.jsx(Xe,{tickFormatter:o=>N(o)}),e.jsx(Pe,{formatter:o=>N(Number(o)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(ge,{dataKey:"current",fill:"hsl(var(--muted))",name:"Atual"}),e.jsx(ge,{dataKey:"projected",fill:"hsl(var(--primary))",name:"Projetado"})]})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",children:"Aplicar SimulaÃ§Ã£o"}),e.jsx(w,{variant:"outline",children:"Exportar Resultados"})]})]})]})})}function ia(){return je(),e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ea,{}),e.jsxs(w,{onClick:()=>{window.dispatchEvent(new CustomEvent("saveAllSalesData")),console.log("Saving all sales management data...")},size:"lg",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"ðŸ’¾ SALVAR TODOS OS DADOS"]})]}),e.jsxs(Ve,{defaultValue:"comparison",className:"space-y-6",children:[e.jsxs(Je,{className:"grid w-full grid-cols-3",children:[e.jsx(de,{value:"comparison",children:"Comparativo Anual"}),e.jsx(de,{value:"salespeople",children:"Vendedoras"}),e.jsx(de,{value:"simulation",children:"SimulaÃ§Ã£o"})]}),e.jsx(me,{value:"comparison",className:"space-y-6",children:e.jsx(ra,{})}),e.jsx(me,{value:"salespeople",className:"space-y-6",children:e.jsx(ta,{})}),e.jsx(me,{value:"simulation",className:"space-y-6",children:e.jsx(na,{})})]})]})}export{ia as default};
