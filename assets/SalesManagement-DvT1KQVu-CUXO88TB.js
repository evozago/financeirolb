import{O as xe,v as c,$ as Ae,i as e,o as U,r as Ee,z as S,t as pe,u as De,x as Fe,y as me,B as ue,h as B,w as K,j as G,H as Ve,c as M,A as je,K as $e,C as ze,Z as te,l as N,p as ce,a as W,n as Q,s as ee,b as ae,S as se,D as Ne,X as ye,E as be,Y as _e,G as we,J as Se,L as Ce,M as k,N as Re,P as Be,Q as Me,R as fe,T as X,U as qe,W as Z,_ as ke,a0 as Ye,a1 as Ie,a2 as Oe,a3 as ie,V as Je,F as Le,d as Pe,e as Ke,g as ge,a4 as z,f as Ge}from"./index-BwnXncx-.js";import{V as Te,P as He,l as Ue,u as Xe}from"./BarChart-DkYFM_FY-DJ1qjDSl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=xe("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const We=xe("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
* @license lucide-react v0.462.0 - ISC
*
* This source code is licensed under the ISC license.
* See the LICENSE file in the root directory of this source tree.
*/const Qe=xe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function ea(){const g=w=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(w),t=new Date().getFullYear();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sistema de GestÃ£o de Vendas"}),e.jsx("p",{className:"text-muted-foreground",children:"Painel interativo para gerenciamento de vendas, metas e simulaÃ§Ãµes de crescimento"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(B,{children:[e.jsxs(K,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(G,{className:"text-sm font-medium",children:["Total Vendido ",t]}),e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g(85e4)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Acumulado atÃ© ",new Date().toLocaleDateString("pt-BR",{month:"long"})]})]})]}),e.jsxs(B,{children:[e.jsxs(K,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Crescimento Acumulado"}),e.jsx(je,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+",12.5.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs ano anterior"})]})]}),e.jsxs(B,{children:[e.jsxs(K,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(G,{className:"text-sm font-medium",children:"Vendedoras Ativas"}),e.jsx($e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:8}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Ãšltima atualizaÃ§Ã£o: ",new Date().toLocaleString("pt-BR")]})]})]})]})]})}const aa=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];async function sa(){const{data:g,error:t}=await N.from("entidades_corporativas").select("id").order("created_at",{ascending:!0});return t?(console.error("Erro ao buscar entidades_corporativas:",t.message),null):!g||g.length===0?null:g[0].id}function ve(){const{user:g}=ze(),[t,w]=c.useState(!0),[x,Y]=c.useState(new Date().getFullYear()),[E,F]=c.useState(null),[D,j]=c.useState([]),[I,y]=c.useState([]),C=c.useCallback(async()=>{const l=await sa();return F(l),l},[g==null?void 0:g.id]),b=c.useMemo(()=>!!E,[E]),_=c.useCallback(async()=>{w(!0);try{const l=await C();if(!l){j([]),y([]),te({title:"Nenhuma Entidade Encontrada",description:"Configure pelo menos uma entidade corporativa no sistema para usar o mÃ³dulo de vendas.",variant:"destructive"});return}const i=[x,x-1,x-2],{data:u,error:f}=await N.from("store_monthly_sales").select("*").eq("entity_id",l).in("year",i);if(f)throw f;const s=aa.map((h,A)=>{const O=A+1,T={month:O,monthName:h,years:{}};return i.forEach($=>{const a=u==null?void 0:u.find(r=>r.year===$&&r.month===O);T.years[$]=a?Number(a.total_sales):""}),T});j(s);const{data:v,error:d}=await N.rpc("get_pessoas_with_papeis");let p=[];if(d){console.warn("Erro ao buscar pessoas com papÃ©is:",d);const{data:h,error:A}=await N.from("pessoas").select("id, nome, ativo, cpf_cnpj_normalizado, eh_vendedora").eq("ativo",!0).eq("eh_vendedora",!0);if(A)throw A;p=(h||[]).map(O=>({...O,source:"pessoas",eh_vendedora:!0}))}else p=(v||[]).filter(h=>h.papeis&&h.papeis.includes("vendedora")).map(h=>({...h,source:"pessoas",eh_vendedora:!0}));const{data:n,error:m}=await N.from("sales_goals").select("salesperson_id, month, goal_amount").eq("entity_id",l).eq("year",x);if(m)throw m;const{data:V,error:oe}=await N.from("salesperson_sales").select("salesperson_id, month, sales_amount").eq("entity_id",l).eq("year",x);if(oe)throw oe;const re=new Map;for(const h of n??[]){const A=h.salesperson_id,O=Number(h.month),T=Number(h.goal_amount??0),$=re.get(A)??{};$[O]=T,re.set(A,$)}const ne=new Map;for(const h of V??[]){const A=h.salesperson_id,O=Number(h.month),T=Number(h.sales_amount??0),$=ne.get(A)??{};$[O]=T,ne.set(A,$)}const le=new Map;(p??[]).forEach(h=>{const A=`${(h.nome||"").trim().toUpperCase()}-${h.cpf_cnpj_normalizado||""}`;le.has(A)||le.set(A,h)});const de=Array.from(le.values()).map(h=>({salesperson_id:h.id,salesperson_name:h.nome,monthly_goals:re.get(h.id)??{},monthly_sales:ne.get(h.id)??{}}));y(de)}catch(l){console.error("Erro ao buscar dados:",l),te({title:"Falha ao carregar",description:l.message??String(l),variant:"destructive"})}finally{w(!1)}},[C,x]);return c.useEffect(()=>{_()},[_]),{loading:t,currentYear:x,setCurrentYear:Y,yearlyData:D,updateYearlySale:(l,i,u)=>{j(f=>f.map(s=>s.month===l?{...s,years:{...s.years,[i]:u===""?"":Number(u)}}:s))},salespersonData:I,updateSalespersonGoal:(l,i,u)=>{y(f=>f.map(s=>s.salesperson_id===l?{...s,monthly_goals:{...s.monthly_goals,[i]:u===""?"":Number(u)}}:s))},updateSalespersonSales:(l,i,u)=>{y(f=>f.map(s=>s.salesperson_id===l?{...s,monthly_sales:{...s.monthly_sales,[i]:u===""?"":Number(u)}}:s))},saveAllData:async()=>{const l=E;if(!l){te({title:"Entidade NÃ£o Configurada",description:"Configure uma entidade corporativa no sistema primeiro.",variant:"destructive"});return}w(!0);try{const i=[];if(D.forEach(s=>{Object.entries(s.years).forEach(([v,d])=>{d!==""&&d!==null&&!Number.isNaN(Number(d))&&i.push({entity_id:l,year:Number(v),month:s.month,total_sales:Number(d)})})}),i.length){const{error:s}=await N.from("store_monthly_sales").upsert(i,{onConflict:"entity_id, year, month"});if(s)throw s}const u=[];if(I.forEach(s=>{Object.entries(s.monthly_goals).forEach(([v,d])=>{d!==""&&d!==null&&!Number.isNaN(Number(d))&&u.push({entity_id:l,salesperson_id:s.salesperson_id,year:x,month:Number(v),goal_amount:Number(d)})})}),u.length){const{error:s}=await N.from("sales_goals").upsert(u,{onConflict:"salesperson_id, entity_id, year, month"});if(s)throw s}const f=[];if(I.forEach(s=>{Object.entries(s.monthly_sales).forEach(([v,d])=>{d!==""&&d!==null&&!Number.isNaN(Number(d))&&f.push({entity_id:l,salesperson_id:s.salesperson_id,year:x,month:Number(v),sales_amount:Number(d)})})}),f.length){const{error:s}=await N.from("salesperson_sales").upsert(f,{onConflict:"entity_id, salesperson_id, year, month"});if(s)throw s}te({title:"Salvo!",description:"Vendas e metas persistidas no Supabase."})}catch(i){console.error("Erro ao salvar:",i),te({title:"Falha ao salvar",description:i.message??String(i),variant:"destructive"})}finally{w(!1)}},hasEntity:b,refreshData:_}}function ra(){const{loading:g,currentYear:t,setCurrentYear:w,yearlyData:x,updateYearlySale:Y,saveAllData:E,hasEntity:F}=ve(),[D,j]=c.useState(new Date().getFullYear()+1),[I,y]=c.useState(!1),C=()=>{w(D),y(!1),z.success(`Ano ${D} selecionado para visualizaÃ§Ã£o!`)},b=()=>{if(!F){z.error("Nenhuma entidade configurada. Configure uma entidade corporativa primeiro.");return}E()};c.useEffect(()=>{const s=()=>b();return window.addEventListener("saveAllSalesData",s),()=>window.removeEventListener("saveAllSalesData",s)},[F]);const _=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),l=s=>s>0?e.jsx(je,{className:"w-4 h-4 text-green-600"}):s<0?e.jsx(Ge,{className:"w-4 h-4 text-red-600"}):e.jsx(Ze,{className:"w-4 h-4 text-muted-foreground"}),i=s=>s>0?"text-green-600":s<0?"text-red-600":"text-muted-foreground",u=(s,v)=>!v||v===0?0:(s-v)/v*100,f=s=>s===0?"0%":`${s>0?"+":""}${s.toFixed(1)}%`;return e.jsx("div",{className:"space-y-6",children:e.jsxs(B,{children:[e.jsxs(K,{children:[e.jsx(G,{children:"ComparaÃ§Ã£o Anual de Vendas"}),e.jsx(ce,{children:"HistÃ³rico de vendas mensais e crescimento ano a ano"})]}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{value:t.toString(),onValueChange:s=>w(parseInt(s)),children:[e.jsx(Q,{className:"w-40",children:e.jsx(ee,{})}),e.jsx(ae,{children:Array.from({length:5},(s,v)=>new Date().getFullYear()-v).map(s=>e.jsx(se,{value:s.toString(),children:s},s))})]}),e.jsxs(Ne,{open:I,onOpenChange:y,children:[e.jsx(ye,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Adicionar Ano"]})}),e.jsxs(_e,{children:[e.jsxs(we,{children:[e.jsx(Se,{children:"Adicionar Novo Ano"}),e.jsx(Ce,{children:"Adicione um novo ano para comparaÃ§Ã£o de vendas"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(k,{htmlFor:"new-year",children:"Ano"}),e.jsx(U,{id:"new-year",type:"number",value:D,onChange:s=>j(parseInt(s.target.value))})]})}),e.jsxs(Re,{children:[e.jsx(S,{variant:"outline",onClick:()=>y(!1),children:"Cancelar"}),e.jsx(S,{onClick:C,children:"Adicionar"})]})]})]})]}),e.jsxs(S,{size:"sm",onClick:b,disabled:g||!F,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Salvar AlteraÃ§Ãµes"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:[t,t-1,t-2].map(s=>{const v=x.filter(d=>d.years[s]&&typeof d.years[s]=="number").reduce((d,p)=>d+Number(p.years[s]),0);return e.jsx(B,{className:s===t?"ring-2 ring-primary":"",children:e.jsx(M,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s}),e.jsx("p",{className:"text-2xl font-bold",children:_(v)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-1",children:[l(0),e.jsx("span",{className:`text-sm font-medium ${i(0)}`,children:"+8.5%"})]})})]})})},s)})}),e.jsxs(B,{children:[e.jsx(K,{children:e.jsxs(G,{children:["Detalhamento Mensal - ",t]})}),e.jsx(M,{children:e.jsxs(Be,{children:[e.jsx(Me,{children:e.jsxs(fe,{children:[e.jsx(X,{children:"MÃªs"}),e.jsx(X,{className:"text-right",children:t}),e.jsx(X,{className:"text-center",children:"Crescimento"}),e.jsx(X,{className:"text-right",children:t-1}),e.jsx(X,{className:"text-center",children:"Crescimento"}),e.jsx(X,{className:"text-right",children:t-2})]})}),e.jsx(qe,{children:x.map(s=>{const v=s.years[t]||0,d=s.years[t-1]||0,p=s.years[t-2]||0,n=u(v,d),m=u(d,p);return e.jsxs(fe,{children:[e.jsx(Z,{className:"font-medium",children:s.monthName}),e.jsx(Z,{className:"text-right",children:e.jsx(U,{type:"number",value:typeof s.years[t]=="number"?s.years[t]:"",onChange:V=>Y(s.month,t,V.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})}),e.jsx(Z,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l(n),e.jsx("span",{className:`text-sm font-medium ${i(n)}`,children:f(n)})]})}),e.jsx(Z,{className:"text-right",children:e.jsx(U,{type:"number",value:typeof s.years[t-1]=="number"?s.years[t-1]:"",onChange:V=>Y(s.month,t-1,V.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})}),e.jsx(Z,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l(m),e.jsx("span",{className:`text-sm font-medium ${i(m)}`,children:f(m)})]})}),e.jsx(Z,{className:"text-right",children:e.jsx(U,{type:"number",value:typeof s.years[t-2]=="number"?s.years[t-2]:"",onChange:V=>Y(s.month,t-2,V.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})})]},s.month)})})]})})]})]})]})})}const he=c.forwardRef(({value:g,onValueChange:t,min:w,max:x,step:Y=1,decimals:E=0,className:F,placeholder:D="",...j},I)=>{const[y,C]=c.useState(!1),[b,_]=c.useState(""),l=p=>E>0?p.toFixed(E).replace(".",","):p.toString(),i=p=>{if(!p)return;const n=p.replace(",","."),m=parseFloat(n);return isNaN(m)?void 0:m},u=p=>{let n=p;return w!==void 0&&n<w&&(n=w),x!==void 0&&n>x&&(n=x),n},f=p=>{const n=p.target.value;if(n===""){_(""),t==null||t(void 0);return}if(!(E>0?/^-?\d*[,.]?\d*$/:/^-?\d*$/).test(n))return;_(n);const m=i(n);m===void 0?t==null||t(void 0):t==null||t(m)},s=p=>{var n;if(C(!0),!b){const m=g!==void 0?l(g):"";_(m.replace(/\./g,","))}(n=j.onFocus)==null||n.call(j,p)},v=p=>{var n;C(!1);const m=i(b);if(m===void 0)_(""),t==null||t(void 0);else{const V=u(m);t==null||t(V),_("")}(n=j.onBlur)==null||n.call(j,p)};Ae.useEffect(()=>{y||_("")},[y]);const d=y?b:g!==void 0?l(u(g)):"";return e.jsx(U,{ref:I,type:"text",inputMode:E>0?"decimal":"numeric",value:d,onChange:f,onFocus:s,onBlur:v,placeholder:D,min:w,max:x,step:Y,className:Ee("text-right",F),...j})});he.displayName="NumberInput";function na(){const{loading:g,currentYear:t,setCurrentYear:w,salespersonData:x,updateSalespersonGoal:Y,updateSalespersonSales:E,saveAllData:F,hasEntity:D}=ve(),[j,I]=c.useState(new Date().getMonth()+1),[y,C]=c.useState(!1),[b,_]=c.useState(null),[l,i]=c.useState([]),[u,f]=c.useState(""),[s,v]=c.useState([]),[d,p]=c.useState({});c.useState([]);const[n,m]=c.useState({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),V=async()=>{try{const{data:a,error:r}=await N.from("fornecedores").select("id, nome, cpf, cnpj_cpf, email, telefone, salario, tipo_pessoa, cpf_cnpj_normalizado").eq("ativo",!0).order("nome");if(r)throw r;const{data:R,error:L}=await N.from("entidades_corporativas").select("id, nome_razao_social, cpf_cnpj, cpf_cnpj_normalizado, email, telefone, tipo_pessoa, ativo").eq("ativo",!0).order("nome_razao_social");if(L)throw L;const q=new Map;(a||[]).forEach(o=>{const H=o.tipo_pessoa==="pessoa_fisica"?o.cpf||"":o.cnpj_cpf||"",P=`${(o.nome||"").trim().toUpperCase()}-${(o.cpf_cnpj_normalizado||H||"").trim()}`;q.has(P)||q.set(P,{id:o.id||"",nome:o.nome||"",cpf:H||void 0,email:o.email||void 0,telefone:o.telefone||void 0,salario:o.salario?Number(o.salario):void 0})}),(R||[]).forEach(o=>{const H=o.cpf_cnpj||"",P=`${(o.nome_razao_social||"").trim().toUpperCase()}-${(o.cpf_cnpj_normalizado||H||"").trim()}`;q.has(P)||q.set(P,{id:`entidade:${o.id}`,nome:o.nome_razao_social||"",cpf:H||void 0,email:o.email||void 0,telefone:o.telefone||void 0,salario:void 0})}),i(Array.from(q.values()))}catch(a){console.error("Error loading existing employees:",a),z.error("Erro ao carregar funcionÃ¡rios/vendedoras")}};c.useEffect(()=>{V()},[]);const oe=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),re=async()=>{if(!n.name.trim()){z.error("Nome Ã© obrigatÃ³rio!");return}try{if(u)if(u.startsWith("entidade:")){const a=u.split(":")[1],{data:r,error:R}=await N.from("entidades_corporativas").select("id, nome_razao_social, cpf_cnpj, cpf_cnpj_normalizado, email, telefone, tipo_pessoa").eq("id",a).maybeSingle();if(R)throw R;const L=(r==null?void 0:r.cpf_cnpj_normalizado)||(r!=null&&r.cpf_cnpj?String(r.cpf_cnpj).replace(/\D/g,""):null);let q=null;if(L){const{data:o}=await N.from("fornecedores").select("id").eq("cpf_cnpj_normalizado",L).maybeSingle();q=(o==null?void 0:o.id)??null}if(q){const{error:o}=await N.from("fornecedores").update({eh_vendedora:!0,nome:n.name,salario:n.baseSalary??null,comissao_padrao:n.commissionRate!=null?n.commissionRate*100:null,comissao_supermeta:n.supermetaRate!=null?n.supermetaRate*100:null,meta_mensal:n.metaBase??null}).eq("id",q);if(o)throw o}else{const{error:o}=await N.from("fornecedores").insert([{nome:n.name||(r==null?void 0:r.nome_razao_social)||"",tipo_pessoa:(r==null?void 0:r.tipo_pessoa)||"pessoa_fisica",ativo:!0,eh_vendedora:!0,salario:n.baseSalary??null,comissao_padrao:n.commissionRate!=null?n.commissionRate*100:null,comissao_supermeta:n.supermetaRate!=null?n.supermetaRate*100:null,meta_mensal:n.metaBase??null,cnpj_cpf:(r==null?void 0:r.cpf_cnpj)||null,cpf_cnpj_normalizado:L||null,email:(r==null?void 0:r.email)||null,telefone:(r==null?void 0:r.telefone)||null}]);if(o)throw o}}else{const{error:a}=await N.from("fornecedores").update({eh_vendedora:!0,nome:n.name,salario:n.baseSalary??null,comissao_padrao:n.commissionRate!=null?n.commissionRate*100:null,comissao_supermeta:n.supermetaRate!=null?n.supermetaRate*100:null,meta_mensal:n.metaBase??null}).eq("id",u);if(a)throw a}else{const{error:a}=await N.from("fornecedores").insert([{nome:n.name,tipo_pessoa:"pessoa_fisica",ativo:!0,eh_vendedora:!0,salario:n.baseSalary??null,comissao_padrao:n.commissionRate!=null?n.commissionRate*100:null,comissao_supermeta:n.supermetaRate!=null?n.supermetaRate*100:null,meta_mensal:n.metaBase??null}]);if(a)throw a}await V(),await V(),m({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),f(""),C(!1),z.success("Vendedora adicionada com sucesso!")}catch(a){console.error("Erro ao adicionar vendedora:",a),z.error((a==null?void 0:a.message)||"Falha ao adicionar vendedora")}},ne=async a=>{try{const{data:r,error:R}=await N.from("fornecedores").select("id, nome, salario, comissao_padrao, comissao_supermeta, meta_mensal").eq("id",a.id).single();if(R)throw R;_({id:r.id,name:r.nome,baseSalary:Number(r.salario||0),commissionRate:Number(r.comissao_padrao||0)/100,metaBase:Number(r.meta_mensal||0),supermetaRate:Number(r.comissao_supermeta||0)/100}),m({name:r.nome||"",baseSalary:r.salario?Number(r.salario):void 0,commissionRate:r.comissao_padrao!=null?Number(r.comissao_padrao)/100:void 0,metaBase:r.meta_mensal?Number(r.meta_mensal):void 0,supermetaRate:r.comissao_supermeta!=null?Number(r.comissao_supermeta)/100:void 0})}catch(r){console.error("Erro ao carregar vendedora:",r),z.error("NÃ£o foi possÃ­vel carregar os dados da vendedora")}},le=async()=>{if(!b||!n.name.trim()){z.error("Nome Ã© obrigatÃ³rio!");return}try{const{error:a}=await N.from("fornecedores").update({nome:n.name,salario:n.baseSalary??null,comissao_padrao:n.commissionRate!=null?n.commissionRate*100:null,comissao_supermeta:n.supermetaRate!=null?n.supermetaRate*100:null,meta_mensal:n.metaBase??null}).eq("id",b.id);if(a)throw a;p(r=>({...r,[b.id]:n.name})),_(null),m({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),z.success("Vendedora atualizada com sucesso!")}catch(a){console.error("Erro ao salvar vendedora:",a),z.error("Falha ao salvar alteraÃ§Ãµes")}},de=async a=>{try{const{error:r}=await N.from("fornecedores").update({eh_vendedora:!1}).eq("id",a);if(r)throw r;v(R=>[...R,a]),z.success("Vendedora removida do painel!")}catch(r){console.error("Erro ao remover vendedora:",r),z.error("NÃ£o foi possÃ­vel remover")}},h=(a,r)=>{Y(a,j,r)},A=(a,r)=>{E(a,j,r)},O=()=>{if(!D){z.error("Nenhuma entidade configurada. Configure uma entidade corporativa primeiro.");return}F()};c.useEffect(()=>{const a=()=>O();return window.addEventListener("saveAllSalesData",a),()=>window.removeEventListener("saveAllSalesData",a)},[D]);const T=a=>{const r=l.find(R=>R.id===a);r&&m(R=>({...R,name:r.nome,baseSalary:r.salario||void 0}))},$=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"MarÃ§o"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs(B,{children:[e.jsxs(K,{children:[e.jsx(G,{children:"Painel de Vendedoras"}),e.jsx(ce,{children:"Gerencie informaÃ§Ãµes das vendedoras, metas e comissÃµes"})]}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{value:j.toString(),onValueChange:a=>I(parseInt(a)),children:[e.jsx(Q,{className:"w-40",children:e.jsx(ee,{})}),e.jsx(ae,{children:$.map(a=>e.jsx(se,{value:a.value.toString(),children:a.label},a.value))})]}),e.jsxs(W,{value:t.toString(),onValueChange:a=>w(parseInt(a)),children:[e.jsx(Q,{className:"w-32",children:e.jsx(ee,{})}),e.jsx(ae,{children:Array.from({length:5},(a,r)=>new Date().getFullYear()-r).map(a=>e.jsx(se,{value:a.toString(),children:a},a))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Importar"]}),e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(S,{size:"sm",onClick:O,disabled:g||!D,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Salvar"]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:x&&x.length>0?x.filter(a=>!s.includes(a.salesperson_id)).map(a=>{var r,R,L,q;const o=a.monthly_goals[j]||"",H=typeof o=="number"&&o>0?50:0,P=d[a.salesperson_id]??a.salesperson_name;return e.jsxs(B,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-lg",children:P}),e.jsxs(ce,{children:["Meta ",(r=$.find(J=>J.value===j))==null?void 0:r.label,": ",typeof o=="number"?oe(o):"NÃ£o definida"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>ne({id:a.salesperson_id,name:P,baseSalary:0,commissionRate:.03,metaBase:0,supermetaRate:.05}),children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>{confirm(`Tem certeza que deseja remover ${P}?`)&&de(a.salesperson_id)},children:e.jsx(Oe,{className:"w-4 h-4"})})]})]})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsxs(k,{htmlFor:`goal-${a.salesperson_id}`,className:"text-sm",children:["Meta Mensal - ",(R=$.find(J=>J.value===j))==null?void 0:R.label]}),e.jsx(ie,{value:typeof o=="number"?o:void 0,onValueChange:J=>h(a.salesperson_id,(J==null?void 0:J.toString())||""),placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsxs(k,{htmlFor:`sales-${a.salesperson_id}`,className:"text-sm",children:["Vendas Realizadas - ",(L=$.find(J=>J.value===j))==null?void 0:L.label]}),e.jsx(ie,{value:((q=a.monthly_sales)==null?void 0:q[j])||void 0,onValueChange:J=>A(a.salesperson_id,(J==null?void 0:J.toString())||""),placeholder:"R$ 0,00"})]})]}),e.jsx("div",{className:"flex justify-between items-center pt-2",children:e.jsxs(Je,{variant:H>=100?"default":"secondary",children:[e.jsx(Le,{className:"w-3 h-3 mr-1"}),"Meta definida"]})})]})]},a.salesperson_id)}):e.jsx("div",{className:"col-span-full text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:g?"Carregando vendedoras...":"Nenhuma vendedora encontrada. Adicione vendedoras usando o botÃ£o abaixo."})})}),e.jsxs(Ne,{open:y||!!b,onOpenChange:a=>{a||(C(!1),_(null),m({name:"",baseSalary:2e3,commissionRate:.03,metaBase:15e3,supermetaRate:.05}))},children:[e.jsx(ye,{asChild:!0,children:e.jsxs(S,{variant:"outline",className:"w-full",onClick:()=>C(!0),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Adicionar Nova Vendedora"]})}),e.jsxs(_e,{children:[e.jsxs(we,{children:[e.jsx(Se,{children:b?"Editar Vendedora":"Adicionar Nova Vendedora"}),e.jsx(Ce,{children:"Preencha os dados da vendedora"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"existing",children:"Selecionar FuncionÃ¡rio/Vendedora Existente"}),e.jsxs(W,{value:u,onValueChange:a=>{f(a),T(a)},children:[e.jsx(Q,{children:e.jsx(ee,{placeholder:"Escolher do cadastro existente (opcional)"})}),e.jsx(ae,{children:l.map((a,r)=>e.jsxs(se,{value:a.id,children:[a.nome," ",a.cpf?`(${a.cpf})`:""]},`${a.id}-${r}`))})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"name",children:"Nome"}),e.jsx(U,{id:"name",value:n.name,onChange:a=>m(r=>({...r,name:a.target.value})),placeholder:"Digite o nome"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"baseSalary",children:"SalÃ¡rio Base"}),e.jsx(ie,{value:n.baseSalary,onValueChange:a=>m(r=>({...r,baseSalary:a})),placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"metaBase",children:"Meta Base"}),e.jsx(ie,{value:n.metaBase,onValueChange:a=>m(r=>({...r,metaBase:a})),placeholder:"R$ 0,00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"commissionRate",children:"ComissÃ£o Base (%)"}),e.jsx(he,{value:n.commissionRate?n.commissionRate*100:void 0,onValueChange:a=>m(r=>({...r,commissionRate:a?a/100:void 0})),decimals:2,min:0,max:100,placeholder:"Ex: 3.50"})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"supermetaRate",children:"Super Meta (%)"}),e.jsx(he,{value:n.supermetaRate?n.supermetaRate*100:void 0,onValueChange:a=>m(r=>({...r,supermetaRate:a?a/100:void 0})),decimals:2,min:0,max:100,placeholder:"Ex: 5.00"})]})]})]}),e.jsxs(Re,{children:[e.jsx(S,{variant:"outline",onClick:()=>{C(!1),_(null),f("")},children:"Cancelar"}),e.jsx(S,{onClick:b?le:re,children:b?"Salvar":"Adicionar"})]})]})]})]})]})})}function la(){const[g,t]=c.useState(new Date().getFullYear()),[w,x]=c.useState(new Date().getMonth()+1),[Y,E]=c.useState(5),[F]=c.useState([{month:"Jan",current:45e3,projected:47250},{month:"Fev",current:52e3,projected:54600},{month:"Mar",current:48e3,projected:50400},{month:"Abr",current:55e3,projected:57750},{month:"Mai",current:6e4,projected:63e3},{month:"Jun",current:58e3,projected:60900}]),D=new Date().getFullYear(),j=Array.from({length:5},(l,i)=>D-2+i),I=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"MarÃ§o"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}],y=l=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),C=F.reduce((l,i)=>l+i.current,0),b=F.reduce((l,i)=>l+i.projected,0),_=(b-C)/C*100;return e.jsx("div",{className:"space-y-6",children:e.jsxs(B,{children:[e.jsxs(K,{children:[e.jsx(G,{children:"SimulaÃ§Ã£o de Crescimento"}),e.jsx(ce,{children:"Projete cenÃ¡rios de crescimento baseados em dados histÃ³ricos"})]}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx(k,{htmlFor:"base-year",children:"Ano Base"}),e.jsxs(W,{value:g.toString(),onValueChange:l=>t(parseInt(l)),children:[e.jsx(Q,{id:"base-year",children:e.jsx(ee,{})}),e.jsx(ae,{children:j.map(l=>e.jsx(se,{value:l.toString(),children:l},l))})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"base-month",children:"MÃªs Base"}),e.jsxs(W,{value:w.toString(),onValueChange:l=>x(parseInt(l)),children:[e.jsx(Q,{id:"base-month",children:e.jsx(ee,{})}),e.jsx(ae,{children:I.map(l=>e.jsx(se,{value:l.value.toString(),children:l.label},l.value))})]})]}),e.jsxs("div",{children:[e.jsx(k,{htmlFor:"growth-rate",children:"Taxa de Crescimento (%)"}),e.jsx(U,{id:"growth-rate",type:"number",value:Y,onChange:l=>E(Number(l.target.value)),step:"0.1",min:"0",max:"100"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs(S,{className:"flex-1",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Simular"]}),e.jsx(S,{variant:"outline",size:"icon",children:e.jsx(Qe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(B,{children:e.jsxs(M,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:y(C)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vendas Atuais"})]})}),e.jsx(B,{children:e.jsxs(M,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y(b)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ProjeÃ§Ã£o com Crescimento"})]})}),e.jsx(B,{children:e.jsxs(M,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+",_.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Crescimento Projetado"})]})})]}),e.jsxs(B,{children:[e.jsx(K,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"}),"ComparaÃ§Ã£o: Atual vs Projetado"]})}),e.jsx(M,{children:e.jsx(Pe,{width:"100%",height:300,children:e.jsxs(Te,{data:F,children:[e.jsx(He,{strokeDasharray:"3 3"}),e.jsx(Ue,{dataKey:"month"}),e.jsx(Xe,{tickFormatter:l=>y(l)}),e.jsx(Ke,{formatter:l=>y(Number(l)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(ge,{dataKey:"current",fill:"hsl(var(--muted))",name:"Atual"}),e.jsx(ge,{dataKey:"projected",fill:"hsl(var(--primary))",name:"Projetado"})]})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",children:"Aplicar SimulaÃ§Ã£o"}),e.jsx(S,{variant:"outline",children:"Exportar Resultados"})]})]})]})})}function ia(){return ve(),e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ea,{}),e.jsxs(S,{onClick:()=>{window.dispatchEvent(new CustomEvent("saveAllSalesData")),console.log("Saving all sales management data...")},size:"lg",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"ðŸ’¾ SALVAR TODOS OS DADOS"]})]}),e.jsxs(De,{defaultValue:"comparison",className:"space-y-6",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-3",children:[e.jsx(me,{value:"comparison",children:"Comparativo Anual"}),e.jsx(me,{value:"salespeople",children:"Vendedoras"}),e.jsx(me,{value:"simulation",children:"SimulaÃ§Ã£o"})]}),e.jsx(ue,{value:"comparison",className:"space-y-6",children:e.jsx(ra,{})}),e.jsx(ue,{value:"salespeople",className:"space-y-6",children:e.jsx(na,{})}),e.jsx(ue,{value:"simulation",className:"space-y-6",children:e.jsx(la,{})})]})]})}export{ia as default};
