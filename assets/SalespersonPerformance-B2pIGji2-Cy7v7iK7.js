import{O as te,v as n,I as de,i as e,a as E,n as k,s as V,b as D,S as N,h as j,V as F,w as f,j as g,p as w,c as _,m as le,d as P,e as K,g as q,k as ne,q as $,l as y}from"./index-BwnXncx-.js";import{V as z,P as I,l as J,u as O}from"./BarChart-DkYFM_FY-DJ1qjDSl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=te("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);function xe(){const[o,R]=n.useState(new Date().getFullYear()),[v,T]=n.useState(new Date().getMonth()+1),[t,B]=n.useState("all"),[m,G]=n.useState([]),[H,L]=n.useState([]),[M,Y]=n.useState([]),[A,Q]=n.useState([]),[ie,C]=n.useState(!0),{toast:b}=de(),U=new Date().getFullYear(),W=Array.from({length:5},(a,r)=>U-r),S=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"Março"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}],i=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),X=async()=>{try{const{data:a,error:r}=await y.from("pessoas").select("id, nome").eq("ativo",!0).contains("papeis",["vendedora"]).order("nome");if(r)throw r;L(a||[])}catch(a){console.error("Error fetching vendedoras:",a),b({title:"Erro",description:"Erro ao carregar vendedoras",variant:"destructive"})}},Z=async()=>{try{let a=y.from("vendas").select(`
          vendedora_id,
          valor_venda,
          data_venda,
          vendedoras!inner(nome)
        `).gte("data_venda",`${o}-${v.toString().padStart(2,"0")}-01`).lt("data_venda",`${o}-${(v+1).toString().padStart(2,"0")}-01`);t!=="all"&&(a=a.eq("vendedora_id",t));const{data:r,error:c}=await a;if(c)throw c;let u=y.from("metas_mensais").select(`
          vendedora_id,
          meta_valor,
          vendedoras!inner(nome)
        `).eq("ano",o).eq("mes",v);t!=="all"&&(u=u.eq("vendedora_id",t));const{data:x,error:h}=await u;if(h)throw h;const d=new Map;x==null||x.forEach(s=>{var l;d.set(s.vendedora_id,{vendedora_id:s.vendedora_id,vendedora_nome:((l=s.vendedoras)==null?void 0:l.nome)||"",vendas_periodo:0,meta_periodo:s.meta_valor,percentual_meta:0,comissao_calculada:0,vendas_mes_anterior:0,crescimento_mom:0,dias_ferias:0})}),r==null||r.forEach(s=>{var l;const p=d.get(s.vendedora_id)||{vendedora_id:s.vendedora_id,vendedora_nome:((l=s.vendedoras)==null?void 0:l.nome)||"",vendas_periodo:0,meta_periodo:0,percentual_meta:0,comissao_calculada:0,vendas_mes_anterior:0,crescimento_mom:0,dias_ferias:0};p.vendas_periodo+=s.valor_venda,d.set(s.vendedora_id,p)}),d.forEach((s,l)=>{if(s.meta_periodo>0&&(s.percentual_meta=s.vendas_periodo/s.meta_periodo*100),s.vendas_periodo<=s.meta_periodo)s.comissao_calculada=s.vendas_periodo*.03;else{const p=s.meta_periodo*.03,re=(s.vendas_periodo-s.meta_periodo)*.05;s.comissao_calculada=p+re}}),G(Array.from(d.values()))}catch(a){console.error("Error fetching performance data:",a),b({title:"Erro",description:"Erro ao carregar dados de performance",variant:"destructive"})}},ee=async()=>{if(t!=="all")try{const{data:a,error:r}=await y.from("vendedora_ferias").select("*").eq("vendedora_id",t).eq("aprovado",!0).order("data_inicio",{ascending:!1});if(r)throw r;Y(a||[])}catch(a){console.error("Error fetching vacation periods:",a),b({title:"Erro",description:"Erro ao carregar períodos de férias",variant:"destructive"})}},ae=async()=>{if(t!=="all")try{const{data:a,error:r}=await y.from("sales_monthly_summary").select("ano, mes, total_vendas, meta_mensal").eq("vendedora_id",t).eq("ano",o).order("mes");if(r)throw r;const c=Array.from({length:12},(u,x)=>{const h=a==null?void 0:a.find(p=>p.mes===x+1),d=(h==null?void 0:h.total_vendas)||0,s=(h==null?void 0:h.meta_mensal)||0;let l=0;return d<=s?l=d*.03:l=s*.03+(d-s)*.05,{mes:S[x].label,vendas:d,meta:s,comissao:l}});Q(c)}catch(a){console.error("Error fetching monthly performance:",a),b({title:"Erro",description:"Erro ao carregar performance mensal",variant:"destructive"})}};n.useEffect(()=>{X()},[]),n.useEffect(()=>{(async()=>{C(!0);try{await Promise.all([Z(),ee(),ae()])}finally{C(!1)}})()},[o,v,t]);const se=a=>{const r=new Date;return M.some(c=>{const u=new Date(c.data_inicio),x=new Date(c.data_fim);return r>=u&&r<=x})};return e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Performance das Vendedoras"}),e.jsx("p",{className:"text-muted-foreground",children:"Acompanhe o desempenho individual, metas e comissões"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{value:t,onValueChange:B,children:[e.jsx(k,{className:"w-48",children:e.jsx(V,{})}),e.jsxs(D,{children:[e.jsx(N,{value:"all",children:"Todas as Vendedoras"}),H.map(a=>e.jsx(N,{value:a.id,children:a.nome},a.id))]})]}),e.jsxs(E,{value:v.toString(),onValueChange:a=>T(parseInt(a)),children:[e.jsx(k,{className:"w-40",children:e.jsx(V,{})}),e.jsx(D,{children:S.map(a=>e.jsx(N,{value:a.value.toString(),children:a.label},a.value))})]}),e.jsxs(E,{value:o.toString(),onValueChange:a=>R(parseInt(a)),children:[e.jsx(k,{className:"w-32",children:e.jsx(V,{})}),e.jsx(D,{children:W.map(a=>e.jsx(N,{value:a.toString(),children:a},a))})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:m.map(a=>{var r;return e.jsxs(j,{className:"relative",children:[t!=="all"&&se(a.vendedora_id)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(F,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"Férias"]})}),e.jsxs(f,{className:"pb-3",children:[e.jsx(g,{className:"text-lg",children:a.vendedora_nome}),e.jsxs(w,{children:[(r=S.find(c=>c.value===v))==null?void 0:r.label," ",o]})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Vendas vs Meta"}),e.jsxs("span",{className:"text-sm font-medium",children:[a.percentual_meta.toFixed(1),"%"]})]}),e.jsx(le,{value:Math.min(a.percentual_meta,100),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:i(a.vendas_periodo)}),e.jsx("span",{children:i(a.meta_periodo)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Comissão"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:i(a.comissao_calculada)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(F,{variant:a.percentual_meta>=100?"default":"secondary",children:a.percentual_meta>=100?"Meta atingida":"Em andamento"})]})]})]})]},a.vendedora_id)})}),t!=="all"&&e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{children:["Performance Anual - ",o]}),e.jsx(w,{children:"Vendas vs Meta mensal da vendedora selecionada"})]}),e.jsx(_,{children:e.jsx(P,{width:"100%",height:300,children:e.jsxs(z,{data:A,children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"mes"}),e.jsx(O,{tickFormatter:a=>i(a)}),e.jsx(K,{formatter:a=>i(Number(a)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(q,{dataKey:"vendas",fill:"hsl(var(--primary))",name:"Vendas"}),e.jsx(q,{dataKey:"meta",fill:"hsl(var(--muted))",name:"Meta"})]})})})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{children:["Evolução da Comissão - ",o]}),e.jsx(w,{children:"Comissões mensais baseadas nas vendas realizadas"})]}),e.jsx(_,{children:e.jsx(P,{width:"100%",height:300,children:e.jsxs(z,{data:A,children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"mes"}),e.jsx(O,{tickFormatter:a=>i(a)}),e.jsx(K,{formatter:a=>i(Number(a)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(q,{dataKey:"comissao",fill:"hsl(var(--primary))",name:"Comissão"})]})})})]})]}),t!=="all"&&M.length>0&&e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Períodos de Férias"}),e.jsx(w,{children:"Histórico de férias da vendedora selecionada"})]}),e.jsx(_,{children:e.jsx("div",{className:"space-y-3",children:M.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[$(new Date(a.data_inicio),"dd/MM/yyyy")," - ",$(new Date(a.data_fim),"dd/MM/yyyy")]}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:a.tipo_ferias})]})]}),e.jsx(F,{variant:a.aprovado?"default":"secondary",children:a.aprovado?"Aprovado":"Pendente"})]},a.id))})})]}),m.length>0&&e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(g,{children:"Resumo Estatístico"})}),e.jsx(_,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:m.filter(a=>a.percentual_meta>=100).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Metas Atingidas"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i(m.reduce((a,r)=>a+r.comissao_calculada,0))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Comissões"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:i(m.reduce((a,r)=>a+r.vendas_periodo,0))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Vendas"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[(m.reduce((a,r)=>a+r.vendas_periodo,0)/m.reduce((a,r)=>a+r.meta_periodo,0)*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Performance Geral"})]})]})})]})]})}export{xe as default};
