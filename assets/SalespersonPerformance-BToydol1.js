import{c as te,r as o,u as de,j as e,S as C,a as E,b as V,d as k,e as N,C as j,B as D,f,g,l as w,h as _,P as ne,R as q,m as B,n as P,o as oe,p as I,s as y}from"./index-BMWLaPCr.js";import{B as T,C as Y,X as R,Y as K}from"./BarChart-D8xVrmcQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=te("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);function xe(){const[l,z]=o.useState(new Date().getFullYear()),[u,$]=o.useState(new Date().getMonth()+1),[t,J]=o.useState("all"),[h,L]=o.useState([]),[G,H]=o.useState([]),[S,O]=o.useState([]),[A,Q]=o.useState([]),[ie,F]=o.useState(!0),{toast:b}=de(),X=new Date().getFullYear(),U=Array.from({length:5},(a,s)=>X-s),M=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"Março"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}],i=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),W=async()=>{try{const{data:a,error:s}=await y.from("pessoas").select("id, nome").eq("ativo",!0).contains("papeis",["vendedora"]).order("nome");if(s)throw s;H(a||[])}catch(a){console.error("Error fetching vendedoras:",a),b({title:"Erro",description:"Erro ao carregar vendedoras",variant:"destructive"})}},Z=async()=>{try{let a=y.from("vendas").select(`
          vendedora_id,
          valor_venda,
          data_venda,
          vendedoras!inner(nome)
        `).gte("data_venda",`${l}-${u.toString().padStart(2,"0")}-01`).lt("data_venda",`${l}-${(u+1).toString().padStart(2,"0")}-01`);t!=="all"&&(a=a.eq("vendedora_id",t));const{data:s,error:c}=await a;if(c)throw c;let v=y.from("metas_mensais").select(`
          vendedora_id,
          meta_valor,
          vendedoras!inner(nome)
        `).eq("ano",l).eq("mes",u);t!=="all"&&(v=v.eq("vendedora_id",t));const{data:x,error:m}=await v;if(m)throw m;const d=new Map;x==null||x.forEach(r=>{var n;d.set(r.vendedora_id,{vendedora_id:r.vendedora_id,vendedora_nome:((n=r.vendedoras)==null?void 0:n.nome)||"",vendas_periodo:0,meta_periodo:r.meta_valor,percentual_meta:0,comissao_calculada:0,vendas_mes_anterior:0,crescimento_mom:0,dias_ferias:0})}),s==null||s.forEach(r=>{var p;const n=d.get(r.vendedora_id)||{vendedora_id:r.vendedora_id,vendedora_nome:((p=r.vendedoras)==null?void 0:p.nome)||"",vendas_periodo:0,meta_periodo:0,percentual_meta:0,comissao_calculada:0,vendas_mes_anterior:0,crescimento_mom:0,dias_ferias:0};n.vendas_periodo+=r.valor_venda,d.set(r.vendedora_id,n)}),d.forEach((r,n)=>{if(r.meta_periodo>0&&(r.percentual_meta=r.vendas_periodo/r.meta_periodo*100),r.vendas_periodo<=r.meta_periodo)r.comissao_calculada=r.vendas_periodo*.03;else{const p=r.meta_periodo*.03,re=(r.vendas_periodo-r.meta_periodo)*.05;r.comissao_calculada=p+re}}),L(Array.from(d.values()))}catch(a){console.error("Error fetching performance data:",a),b({title:"Erro",description:"Erro ao carregar dados de performance",variant:"destructive"})}},ee=async()=>{if(t!=="all")try{const{data:a,error:s}=await y.from("vendedora_ferias").select("*").eq("vendedora_id",t).eq("aprovado",!0).order("data_inicio",{ascending:!1});if(s)throw s;O(a||[])}catch(a){console.error("Error fetching vacation periods:",a),b({title:"Erro",description:"Erro ao carregar períodos de férias",variant:"destructive"})}},ae=async()=>{if(t!=="all")try{const{data:a,error:s}=await y.from("sales_monthly_summary").select("ano, mes, total_vendas, meta_mensal").eq("vendedora_id",t).eq("ano",l).order("mes");if(s)throw s;const c=Array.from({length:12},(v,x)=>{const m=a==null?void 0:a.find(p=>p.mes===x+1),d=(m==null?void 0:m.total_vendas)||0,r=(m==null?void 0:m.meta_mensal)||0;let n=0;return d<=r?n=d*.03:n=r*.03+(d-r)*.05,{mes:M[x].label,vendas:d,meta:r,comissao:n}});Q(c)}catch(a){console.error("Error fetching monthly performance:",a),b({title:"Erro",description:"Erro ao carregar performance mensal",variant:"destructive"})}};o.useEffect(()=>{W()},[]),o.useEffect(()=>{(async()=>{F(!0);try{await Promise.all([Z(),ee(),ae()])}finally{F(!1)}})()},[l,u,t]);const se=a=>{const s=new Date;return S.some(c=>{const v=new Date(c.data_inicio),x=new Date(c.data_fim);return s>=v&&s<=x})};return e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Performance das Vendedoras"}),e.jsx("p",{className:"text-muted-foreground",children:"Acompanhe o desempenho individual, metas e comissões"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{value:t,onValueChange:J,children:[e.jsx(E,{className:"w-48",children:e.jsx(V,{})}),e.jsxs(k,{children:[e.jsx(N,{value:"all",children:"Todas as Vendedoras"}),G.map(a=>e.jsx(N,{value:a.id,children:a.nome},a.id))]})]}),e.jsxs(C,{value:u.toString(),onValueChange:a=>$(parseInt(a)),children:[e.jsx(E,{className:"w-40",children:e.jsx(V,{})}),e.jsx(k,{children:M.map(a=>e.jsx(N,{value:a.value.toString(),children:a.label},a.value))})]}),e.jsxs(C,{value:l.toString(),onValueChange:a=>z(parseInt(a)),children:[e.jsx(E,{className:"w-32",children:e.jsx(V,{})}),e.jsx(k,{children:U.map(a=>e.jsx(N,{value:a.toString(),children:a},a))})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:h.map(a=>{var s;return e.jsxs(j,{className:"relative",children:[t!=="all"&&se(a.vendedora_id)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(D,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Férias"]})}),e.jsxs(f,{className:"pb-3",children:[e.jsx(g,{className:"text-lg",children:a.vendedora_nome}),e.jsxs(w,{children:[(s=M.find(c=>c.value===u))==null?void 0:s.label," ",l]})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Vendas vs Meta"}),e.jsxs("span",{className:"text-sm font-medium",children:[a.percentual_meta.toFixed(1),"%"]})]}),e.jsx(ne,{value:Math.min(a.percentual_meta,100),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:i(a.vendas_periodo)}),e.jsx("span",{children:i(a.meta_periodo)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Comissão"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:i(a.comissao_calculada)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(D,{variant:a.percentual_meta>=100?"default":"secondary",children:a.percentual_meta>=100?"Meta atingida":"Em andamento"})]})]})]})]},a.vendedora_id)})}),t!=="all"&&e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{children:["Performance Anual - ",l]}),e.jsx(w,{children:"Vendas vs Meta mensal da vendedora selecionada"})]}),e.jsx(_,{children:e.jsx(q,{width:"100%",height:300,children:e.jsxs(T,{data:A,children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(R,{dataKey:"mes"}),e.jsx(K,{tickFormatter:a=>i(a)}),e.jsx(B,{formatter:a=>i(Number(a)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(P,{dataKey:"vendas",fill:"hsl(var(--primary))",name:"Vendas"}),e.jsx(P,{dataKey:"meta",fill:"hsl(var(--muted))",name:"Meta"})]})})})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsxs(g,{children:["Evolução da Comissão - ",l]}),e.jsx(w,{children:"Comissões mensais baseadas nas vendas realizadas"})]}),e.jsx(_,{children:e.jsx(q,{width:"100%",height:300,children:e.jsxs(T,{data:A,children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(R,{dataKey:"mes"}),e.jsx(K,{tickFormatter:a=>i(a)}),e.jsx(B,{formatter:a=>i(Number(a)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(P,{dataKey:"comissao",fill:"hsl(var(--primary))",name:"Comissão"})]})})})]})]}),t!=="all"&&S.length>0&&e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Períodos de Férias"}),e.jsx(w,{children:"Histórico de férias da vendedora selecionada"})]}),e.jsx(_,{children:e.jsx("div",{className:"space-y-3",children:S.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[I(new Date(a.data_inicio),"dd/MM/yyyy")," - ",I(new Date(a.data_fim),"dd/MM/yyyy")]}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:a.tipo_ferias})]})]}),e.jsx(D,{variant:a.aprovado?"default":"secondary",children:a.aprovado?"Aprovado":"Pendente"})]},a.id))})})]}),h.length>0&&e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(g,{children:"Resumo Estatístico"})}),e.jsx(_,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:h.filter(a=>a.percentual_meta>=100).length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Metas Atingidas"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:i(h.reduce((a,s)=>a+s.comissao_calculada,0))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Comissões"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:i(h.reduce((a,s)=>a+s.vendas_periodo,0))}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Vendas"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:[(h.reduce((a,s)=>a+s.vendas_periodo,0)/h.reduce((a,s)=>a+s.meta_periodo,0)*100).toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Performance Geral"})]})]})})]})]})}export{xe as default};
