import{O as Q,v,i as e,a as O,n as z,s as q,b as G,S as $,h as m,w as h,j as x,H as U,c as g,F as W,V as R,A as T,f as B,p as A,d as E,e as P,g as k,K as X,k as ee,I as ae,l as D}from"./index-BwnXncx-.js";import{V as F,P as I,l as J,u as Y}from"./BarChart-DkYFM_FY-DJ1qjDSl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=Q("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);function te(p,_){const[f,y]=v.useState(null),[w,N]=v.useState([]),[t,b]=v.useState([]),[V,M]=v.useState([]),[H,S]=v.useState(!0),{toast:C}=ae(),i=async()=>{try{const{data:s,error:o}=await D.from("pessoas").select("id, nome, ativo, papeis").eq("ativo",!0).contains("papeis",["vendedora"]).limit(10);return!o&&s&&s.length>0?s.map(r=>({id:r.id,nome:r.nome,ativo:r.ativo})):[]}catch(s){return console.warn("Erro ao buscar vendedoras reais:",s),[]}},u=async()=>{var s,o,r;try{const{data:d,error:c}=await D.rpc("get_sales_kpi_data",{p_year:p,p_month:_});if(c){console.warn("Erro ao buscar KPI data:",c);const n=await i(),l=n.length;y({total_sales:0,total_goal:0,goal_achievement_percentage:0,mom_growth_percentage:0,yoy_growth_percentage:0,active_salespeople:l,top_performer_name:((s=n[0])==null?void 0:s.nome)||"Nenhuma vendedora encontrada",top_performer_sales:0});return}if(d&&d.length>0)y(d[0]);else{const n=await i();y({total_sales:0,total_goal:0,goal_achievement_percentage:0,mom_growth_percentage:0,yoy_growth_percentage:0,active_salespeople:n.length,top_performer_name:((o=n[0])==null?void 0:o.nome)||"Nenhuma vendedora encontrada",top_performer_sales:0})}}catch(d){console.warn("Erro ao buscar KPI data:",d);const c=await i();y({total_sales:0,total_goal:0,goal_achievement_percentage:0,mom_growth_percentage:0,yoy_growth_percentage:0,active_salespeople:c.length,top_performer_name:((r=c[0])==null?void 0:r.nome)||"Nenhuma vendedora encontrada",top_performer_sales:0})}},a=async()=>{try{const s=await i(),{data:o,error:r}=await D.rpc("calculate_mom_growth",{p_year:p,p_month:_});if(r||!o||o.length===0){console.warn("Erro ao buscar dados MoM:",r);const n=s.map((l,K)=>({vendedora_id:l.id,vendedora_nome:l.nome,current_sales:0,previous_sales:0,growth_percentage:0}));N(n)}else N(o);const{data:d,error:c}=await D.rpc("calculate_yoy_growth",{p_year:p,p_month:_});if(c||!d||d.length===0){console.warn("Erro ao buscar dados YoY:",c);const n=s.map((l,K)=>({vendedora_id:l.id,vendedora_nome:l.nome,current_sales:0,previous_year_sales:0,growth_percentage:0}));b(n)}else b(d)}catch(s){console.warn("Erro ao buscar dados de crescimento:",s);const o=(await i()).map(r=>({vendedora_id:r.id,vendedora_nome:r.nome,current_sales:0,previous_sales:0,growth_percentage:0}));N(o),b(o)}},j=async()=>{try{const{data:s,error:o}=await D.from("sales_monthly_summary").select("ano, mes, total_vendas, meta_mensal").eq("ano",p).order("mes"),r=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];if(o||!s||s.length===0){console.warn("Erro ao buscar dados mensais:",o);const c=r.map(n=>({mes:n,vendas:0,meta:0}));M(c);return}const d=r.map((c,n)=>{const l=s.find(Z=>Z.mes===n+1),K=l?Number(l.total_vendas||0):0,L=l?Number(l.meta_mensal||0):0;return{mes:r[n],vendas:K,meta:L}});M(d)}catch(s){console.warn("Erro ao buscar dados mensais:",s);const o=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"].map(r=>({mes:r,vendas:0,meta:0}));M(o)}};return v.useEffect(()=>{(async()=>{S(!0);try{await Promise.all([u(),a(),j()])}catch(s){console.error("Erro geral ao buscar dados:",s),C({title:"Aviso",description:"Dados de vendas não configurados. Configure vendedoras e metas no sistema.",variant:"default"})}finally{S(!1)}})()},[p,_]),{kpiData:f,momGrowthData:w,yoyGrowthData:t,monthlySalesData:V,loading:H}}function ne(){var p,_;const[f,y]=v.useState(new Date().getFullYear()),[w,N]=v.useState(new Date().getMonth()+1),{kpiData:t,momGrowthData:b,yoyGrowthData:V,monthlySalesData:M,loading:H}=te(f,w),S=new Date().getFullYear(),C=Array.from({length:5},(a,j)=>S-j),i=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"Março"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}],u=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a);return e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard de Vendas"}),e.jsx("p",{className:"text-muted-foreground",children:"Acompanhe o desempenho das vendas e metas mensais"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{value:w.toString(),onValueChange:a=>N(parseInt(a)),children:[e.jsx(z,{className:"w-40",children:e.jsx(q,{})}),e.jsx(G,{children:i.map(a=>e.jsx($,{value:a.value.toString(),children:a.label},a.value))})]}),e.jsxs(O,{value:f.toString(),onValueChange:a=>y(parseInt(a)),children:[e.jsx(z,{className:"w-32",children:e.jsx(q,{})}),e.jsx(G,{children:C.map(a=>e.jsx($,{value:a.toString(),children:a},a))})]})]})]}),t&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(m,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Vendas do Mês"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u(t.total_sales)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Meta: ",u(t.total_goal)]})]})]}),e.jsxs(m,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Atingimento da Meta"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[t.goal_achievement_percentage,"%"]}),e.jsx(R,{variant:t.goal_achievement_percentage>=100?"default":"secondary",children:t.goal_achievement_percentage>=100?"Meta atingida":"Abaixo da meta"})]})]}),e.jsxs(m,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Crescimento MoM"}),t.mom_growth_percentage>=0?e.jsx(T,{className:"h-4 w-4 text-green-600"}):e.jsx(B,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:`text-2xl font-bold ${t.mom_growth_percentage>=0?"text-green-600":"text-red-600"}`,children:[t.mom_growth_percentage>0?"+":"",t.mom_growth_percentage,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs mês anterior"})]})]}),e.jsxs(m,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Crescimento YoY"}),t.yoy_growth_percentage>=0?e.jsx(T,{className:"h-4 w-4 text-green-600"}):e.jsx(B,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:`text-2xl font-bold ${t.yoy_growth_percentage>=0?"text-green-600":"text-red-600"}`,children:[t.yoy_growth_percentage>0?"+":"",t.yoy_growth_percentage,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs ano anterior"})]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsxs(x,{children:["Vendas vs Meta - ",f]}),e.jsx(A,{children:"Acompanhamento mensal das vendas realizadas versus metas estabelecidas"})]}),e.jsx(g,{children:e.jsx(E,{width:"100%",height:300,children:e.jsxs(F,{data:M,children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"mes"}),e.jsx(Y,{tickFormatter:a=>u(a)}),e.jsx(P,{formatter:a=>u(Number(a)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(k,{dataKey:"vendas",fill:"hsl(var(--primary))",name:"Vendas"}),e.jsx(k,{dataKey:"meta",fill:"hsl(var(--muted))",name:"Meta"})]})})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsxs(x,{children:["Top Vendedoras - ",(p=i.find(a=>a.value===w))==null?void 0:p.label," ",f]}),e.jsx(A,{children:"Ranking das melhores performances do mês"})]}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:b.slice(0,5).map((a,j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${j===0?"bg-yellow-100 text-yellow-800":j===1?"bg-gray-100 text-gray-800":j===2?"bg-orange-100 text-orange-800":"bg-muted text-muted-foreground"}`,children:j+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.vendedora_nome}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u(a.current_sales)})]})]}),e.jsxs(R,{variant:a.growth_percentage>=0?"default":"secondary",children:[a.growth_percentage>0?"+":"",a.growth_percentage,"%"]})]},a.vendedora_id))})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Crescimento Mês vs Mês"}),e.jsx(A,{children:"Performance comparativa com o mês anterior"})]}),e.jsx(g,{children:e.jsx(E,{width:"100%",height:300,children:e.jsxs(F,{data:b.slice(0,8).map(a=>({...a,color:a.growth_percentage>=0?"hsl(var(--primary))":"hsl(var(--destructive))"})),children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"vendedora_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Y,{}),e.jsx(P,{formatter:a=>[`${a}%`,"Crescimento"],labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(k,{dataKey:"growth_percentage",fill:"hsl(var(--primary))",name:"Crescimento %"})]})})})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Crescimento Ano vs Ano"}),e.jsx(A,{children:"Performance comparativa com o mesmo mês do ano anterior"})]}),e.jsx(g,{children:e.jsx(E,{width:"100%",height:300,children:e.jsxs(F,{data:V.slice(0,8).map(a=>({...a,color:a.growth_percentage>=0?"hsl(var(--primary))":"hsl(var(--destructive))"})),children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"vendedora_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(Y,{}),e.jsx(P,{formatter:a=>[`${a}%`,"Crescimento"],labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(k,{dataKey:"growth_percentage",fill:"hsl(var(--primary))",name:"Crescimento %"})]})})})]})]}),t&&e.jsxs(m,{children:[e.jsx(h,{children:e.jsx(x,{children:"Insights Principais"})}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(se,{className:"h-8 w-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Top Performer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.top_performer_name}),e.jsx("p",{className:"text-sm font-medium",children:u(t.top_performer_sales)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(X,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Vendedoras Ativas"}),e.jsx("p",{className:"text-2xl font-bold",children:t.active_salespeople}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"participaram das vendas"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(ee,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Período"}),e.jsxs("p",{className:"text-sm font-medium",children:[(_=i.find(a=>a.value===w))==null?void 0:_.label," ",f]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"dados atualizados"})]})]})]})})]})]})}export{ne as default};
