import{c as ue,j as e,C as Y,f as G,g as L,D as Ae,h as T,i as he,U as Fe,q as Be,r as m,t as se,s as S,l as le,S as U,a as H,b as K,d as X,e as Q,v as be,w as Se,x as w,y as _e,z as we,A as Ee,E as Ce,F as Re,L as $,I as O,G as De,H as xe,J as Me,K as Ie,M as Ne,N as V,O as Ye,Q as J,V as I,k as Te,W as ke,X as ze,Y as $e,Z as qe,_ as Pe,$ as Ge,a0 as oe,B as Le,T as Oe,R as Ve,m as Je,n as ye,a1 as Ue,a2 as He,a3 as ce,a4 as de}from"./index-BMWLaPCr.js";import{B as Ke,C as Xe,X as Qe,Y as We}from"./BarChart-D8xVrmcQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=ue("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=ue("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=ue("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function as(){const v=E=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(E),o=new Date().getFullYear();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sistema de Gestão de Vendas"}),e.jsx("p",{className:"text-muted-foreground",children:"Painel interativo para gerenciamento de vendas, metas e simulações de crescimento"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(Y,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(L,{className:"text-sm font-medium",children:["Total Vendido ",o]}),e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:v(85e4)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Acumulado até ",new Date().toLocaleDateString("pt-BR",{month:"long"})]})]})]}),e.jsxs(Y,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Crescimento Acumulado"}),e.jsx(he,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(T,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+",12.5.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs ano anterior"})]})]}),e.jsxs(Y,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-sm font-medium",children:"Vendedoras Ativas"}),e.jsx(Fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:8}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Última atualização: ",new Date().toLocaleString("pt-BR")]})]})]})]})]})}const ts=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];async function rs(){const{data:v,error:o}=await S.from("entidades_corporativas").select("id").order("created_at",{ascending:!0});return o?(console.error("Erro ao buscar entidades_corporativas:",o.message),null):!v||v.length===0?null:v[0].id}function pe(){const{user:v}=Be(),[o,_]=m.useState(!0),[p,k]=m.useState(new Date().getFullYear()),[E,B]=m.useState(null),[D,j]=m.useState([]),[q,g]=m.useState([]),C=m.useCallback(async()=>{const a=await rs();return B(a),a},[v==null?void 0:v.id]),N=m.useMemo(()=>!!E,[E]),y=m.useCallback(async()=>{_(!0);try{const a=await C();if(!a){j([]),g([]),se({title:"Nenhuma Entidade Encontrada",description:"Configure pelo menos uma entidade corporativa no sistema para usar o módulo de vendas.",variant:"destructive"});return}const d=[p,p-1,p-2],{data:h,error:c}=await S.from("store_monthly_sales").select("*").eq("entity_id",a).in("year",d);if(c)throw c;const r=ts.map((x,b)=>{const s=b+1,n={month:s,monthName:x,years:{}};return d.forEach(u=>{const i=h==null?void 0:h.find(F=>F.year===u&&F.month===s);n.years[u]=i?Number(i.total_sales):""}),n});j(r);const{data:f,error:t}=await S.rpc("get_pessoas_with_papeis");let A=[];if(t){console.warn("Erro ao buscar pessoas com papéis:",t);const{data:x,error:b}=await S.from("pessoas").select("id, nome, ativo, cpf_cnpj_normalizado, eh_vendedora").eq("ativo",!0).eq("eh_vendedora",!0);if(b)throw b;A=(x||[]).map(s=>({...s,source:"pessoas",eh_vendedora:!0}))}else A=(f||[]).filter(x=>x.papeis&&x.papeis.includes("vendedora")).map(x=>({...x,source:"pessoas",eh_vendedora:!0}));const{data:ae,error:te}=await S.from("sales_goals").select("salesperson_id, month, goal_amount").eq("entity_id",a).eq("year",p);if(te)throw te;const{data:ie,error:re}=await S.from("salesperson_sales").select("salesperson_id, month, sales_amount").eq("entity_id",a).eq("year",p);if(re)throw re;const W=new Map;for(const x of ae??[]){const b=x.salesperson_id,s=Number(x.month),n=Number(x.goal_amount??0),u=W.get(b)??{};u[s]=n,W.set(b,u)}const Z=new Map;for(const x of ie??[]){const b=x.salesperson_id,s=Number(x.month),n=Number(x.sales_amount??0),u=Z.get(b)??{};u[s]=n,Z.set(b,u)}const ee=new Map;(A??[]).forEach(x=>{const b=`${(x.nome||"").trim().toUpperCase()}-${x.cpf_cnpj_normalizado||""}`;ee.has(b)||ee.set(b,x)});const ne=Array.from(ee.values()).map(x=>({salesperson_id:x.id,salesperson_name:x.nome,monthly_goals:W.get(x.id)??{},monthly_sales:Z.get(x.id)??{}}));g(ne)}catch(a){console.error("Erro ao buscar dados:",a),se({title:"Falha ao carregar",description:a.message??String(a),variant:"destructive"})}finally{_(!1)}},[C,p]);return m.useEffect(()=>{y()},[y]),{loading:o,currentYear:p,setCurrentYear:k,yearlyData:D,updateYearlySale:(a,d,h)=>{j(c=>c.map(r=>r.month===a?{...r,years:{...r.years,[d]:h===""?"":Number(h)}}:r))},salespersonData:q,updateSalespersonGoal:(a,d,h)=>{g(c=>c.map(r=>r.salesperson_id===a?{...r,monthly_goals:{...r.monthly_goals,[d]:h===""?"":Number(h)}}:r))},updateSalespersonSales:(a,d,h)=>{g(c=>c.map(r=>r.salesperson_id===a?{...r,monthly_sales:{...r.monthly_sales,[d]:h===""?"":Number(h)}}:r))},saveAllData:async()=>{const a=E;if(!a){se({title:"Entidade Não Configurada",description:"Configure uma entidade corporativa no sistema primeiro.",variant:"destructive"});return}_(!0);try{const d=[];if(D.forEach(r=>{Object.entries(r.years).forEach(([f,t])=>{t!==""&&t!==null&&!Number.isNaN(Number(t))&&d.push({entity_id:a,year:Number(f),month:r.month,total_sales:Number(t)})})}),d.length){const{error:r}=await S.from("store_monthly_sales").upsert(d,{onConflict:"entity_id, year, month"});if(r)throw r}const h=[];if(q.forEach(r=>{Object.entries(r.monthly_goals).forEach(([f,t])=>{t!==""&&t!==null&&!Number.isNaN(Number(t))&&h.push({entity_id:a,salesperson_id:r.salesperson_id,year:p,month:Number(f),goal_amount:Number(t)})})}),h.length){const{error:r}=await S.from("sales_goals").upsert(h,{onConflict:"salesperson_id, entity_id, year, month"});if(r)throw r}const c=[];if(q.forEach(r=>{Object.entries(r.monthly_sales).forEach(([f,t])=>{t!==""&&t!==null&&!Number.isNaN(Number(t))&&c.push({entity_id:a,salesperson_id:r.salesperson_id,year:p,month:Number(f),sales_amount:Number(t)})})}),c.length){const{error:r}=await S.from("salesperson_sales").upsert(c,{onConflict:"entity_id, salesperson_id, year, month"});if(r)throw r}se({title:"Salvo!",description:"Vendas e metas persistidas no Supabase."})}catch(d){console.error("Erro ao salvar:",d),se({title:"Falha ao salvar",description:d.message??String(d),variant:"destructive"})}finally{_(!1)}},hasEntity:N,refreshData:y}}function ns(){const{loading:v,currentYear:o,setCurrentYear:_,yearlyData:p,updateYearlySale:k,saveAllData:E,hasEntity:B}=pe(),[D,j]=m.useState(new Date().getFullYear()+1),[q,g]=m.useState(!1),C=()=>{_(D),g(!1),I.success(`Ano ${D} selecionado para visualização!`)},N=()=>{if(!B){I.error("Nenhuma entidade configurada. Configure uma entidade corporativa primeiro.");return}E()};m.useEffect(()=>{const a=()=>N();return window.addEventListener("saveAllSalesData",a),()=>window.removeEventListener("saveAllSalesData",a)},[B]);const y=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),l=a=>a>0?e.jsx(he,{className:"w-4 h-4 text-green-600"}):a<0?e.jsx(Te,{className:"w-4 h-4 text-red-600"}):e.jsx(Ze,{className:"w-4 h-4 text-muted-foreground"}),R=a=>a>0?"text-green-600":a<0?"text-red-600":"text-muted-foreground",z=(a,d)=>!d||d===0?0:(a-d)/d*100,P=a=>a===0?"0%":`${a>0?"+":""}${a.toFixed(1)}%`;return e.jsx("div",{className:"space-y-6",children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(L,{children:"Comparação Anual de Vendas"}),e.jsx(le,{children:"Histórico de vendas mensais e crescimento ano a ano"})]}),e.jsxs(T,{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(U,{value:o.toString(),onValueChange:a=>_(parseInt(a)),children:[e.jsx(H,{className:"w-40",children:e.jsx(K,{})}),e.jsx(X,{children:Array.from({length:5},(a,d)=>new Date().getFullYear()-d).map(a=>e.jsx(Q,{value:a.toString(),children:a},a))})]}),e.jsxs(be,{open:q,onOpenChange:g,children:[e.jsx(Se,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Adicionar Ano"]})}),e.jsxs(we,{children:[e.jsxs(Ee,{children:[e.jsx(Ce,{children:"Adicionar Novo Ano"}),e.jsx(Re,{children:"Adicione um novo ano para comparação de vendas"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx($,{htmlFor:"new-year",children:"Ano"}),e.jsx(O,{id:"new-year",type:"number",value:D,onChange:a=>j(parseInt(a.target.value))})]})}),e.jsxs(De,{children:[e.jsx(w,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(w,{onClick:C,children:"Adicionar"})]})]})]})]}),e.jsxs(w,{size:"sm",onClick:N,disabled:v||!B,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Salvar Alterações"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:[o,o-1,o-2].map(a=>{const d=p.filter(h=>h.years[a]&&typeof h.years[a]=="number").reduce((h,c)=>h+Number(c.years[a]),0);return e.jsx(Y,{className:a===o?"ring-2 ring-primary":"",children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:a}),e.jsx("p",{className:"text-2xl font-bold",children:y(d)})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-1",children:[l(0),e.jsx("span",{className:`text-sm font-medium ${R(0)}`,children:"+8.5%"})]})})]})})},a)})}),e.jsxs(Y,{children:[e.jsx(G,{children:e.jsxs(L,{children:["Detalhamento Mensal - ",o]})}),e.jsx(T,{children:e.jsxs(Me,{children:[e.jsx(Ie,{children:e.jsxs(Ne,{children:[e.jsx(V,{children:"Mês"}),e.jsx(V,{className:"text-right",children:o}),e.jsx(V,{className:"text-center",children:"Crescimento"}),e.jsx(V,{className:"text-right",children:o-1}),e.jsx(V,{className:"text-center",children:"Crescimento"}),e.jsx(V,{className:"text-right",children:o-2})]})}),e.jsx(Ye,{children:p.map(a=>{const d=a.years[o]||0,h=a.years[o-1]||0,c=a.years[o-2]||0,r=z(d,h),f=z(h,c);return e.jsxs(Ne,{children:[e.jsx(J,{className:"font-medium",children:a.monthName}),e.jsx(J,{className:"text-right",children:e.jsx(O,{type:"number",value:typeof a.years[o]=="number"?a.years[o]:"",onChange:t=>k(a.month,o,t.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})}),e.jsx(J,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l(r),e.jsx("span",{className:`text-sm font-medium ${R(r)}`,children:P(r)})]})}),e.jsx(J,{className:"text-right",children:e.jsx(O,{type:"number",value:typeof a.years[o-1]=="number"?a.years[o-1]:"",onChange:t=>k(a.month,o-1,t.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})}),e.jsx(J,{className:"text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[l(f),e.jsx("span",{className:`text-sm font-medium ${R(f)}`,children:P(f)})]})}),e.jsx(J,{className:"text-right",children:e.jsx(O,{type:"number",value:typeof a.years[o-2]=="number"?a.years[o-2]:"",onChange:t=>k(a.month,o-2,t.target.value),className:"text-right w-32 ml-auto",placeholder:"0"})})]},a.month)})})]})})]})]})]})})}const me=m.forwardRef(({value:v,onValueChange:o,min:_,max:p,step:k=1,decimals:E=0,className:B,placeholder:D="",...j},q)=>{const[g,C]=m.useState(!1),[N,y]=m.useState(""),l=c=>E>0?c.toFixed(E).replace(".",","):c.toString(),R=c=>{if(!c)return;const r=c.replace(",","."),f=parseFloat(r);return isNaN(f)?void 0:f},z=c=>{let r=c;return _!==void 0&&r<_&&(r=_),p!==void 0&&r>p&&(r=p),r},P=c=>{const r=c.target.value;if(r===""){y(""),o==null||o(void 0);return}if(!(E>0?/^-?\d*[,.]?\d*$/:/^-?\d*$/).test(r))return;y(r);const t=R(r);t===void 0?o==null||o(void 0):o==null||o(t)},a=c=>{var r;if(C(!0),!N){const f=v!==void 0?l(v):"";y(f.replace(/\./g,","))}(r=j.onFocus)==null||r.call(j,c)},d=c=>{var f;C(!1);const r=R(N);if(r===void 0)y(""),o==null||o(void 0);else{const t=z(r);o==null||o(t),y("")}(f=j.onBlur)==null||f.call(j,c)};ke.useEffect(()=>{g||y("")},[g]);const h=g?N:v!==void 0?l(z(v)):"";return e.jsx(O,{ref:q,type:"text",inputMode:E>0?"decimal":"numeric",value:h,onChange:P,onFocus:a,onBlur:d,placeholder:D,min:_,max:p,step:k,className:ze("text-right",B),...j})});me.displayName="NumberInput";function os(){const{loading:v,currentYear:o,setCurrentYear:_,salespersonData:p,updateSalespersonGoal:k,updateSalespersonSales:E,saveAllData:B,hasEntity:D}=pe(),[j,q]=m.useState(new Date().getMonth()+1),[g,C]=m.useState(!1),[N,y]=m.useState(null),[l,R]=m.useState([]),[z,P]=m.useState(""),[a,d]=m.useState([]),[h,c]=m.useState({}),[r,f]=m.useState([]),[t,A]=m.useState({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),ae=async()=>{try{const{data:s,error:n}=await S.from("pessoas").select("id, nome, cpf, cnpj, email, telefone, tipo_pessoa, cpf_cnpj_normalizado, dados_vendedora").eq("ativo",!0).order("nome");if(n)throw n;const u=(s||[]).map(i=>{var F;return{id:i.id||"",nome:i.nome||"",cpf:i.cpf||i.cnpj||void 0,email:i.email||void 0,telefone:i.telefone||void 0,salario:(F=i.dados_vendedora)!=null&&F.salario_base?Number(i.dados_vendedora.salario_base):void 0}});R(u)}catch(s){console.error("Error loading existing employees:",s),I.error("Erro ao carregar funcionários/vendedoras")}};m.useEffect(()=>{ae()},[]);const te=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),ie=async()=>{if(!t.name.trim()){I.error("Nome é obrigatório!");return}try{const s="e63522f6-da7e-49fe-884e-2b65b82e8456";if(z){const n={salario_base:t.baseSalary||null,comissao_padrao:t.commissionRate!=null?t.commissionRate*100:null,comissao_supermeta:t.supermetaRate!=null?t.supermetaRate*100:null,meta_mensal:t.metaBase||null},{error:u}=await S.from("pessoas").update({nome:t.name,dados_vendedora:n}).eq("id",z);if(u)throw u;const{data:i}=await S.from("papeis_pessoa").select("id").eq("pessoa_id",z).eq("papel_id",s).eq("ativo",!0).maybeSingle();if(!i){const{error:F}=await S.from("papeis_pessoa").insert([{pessoa_id:z,papel_id:s,ativo:!0}]);if(F)throw F}}else{const n={salario_base:t.baseSalary||null,comissao_padrao:t.commissionRate!=null?t.commissionRate*100:null,comissao_supermeta:t.supermetaRate!=null?t.supermetaRate*100:null,meta_mensal:t.metaBase||null},{data:u,error:i}=await S.from("pessoas").insert([{nome:t.name,tipo_pessoa:"pessoa_fisica",ativo:!0,dados_vendedora:n}]).select("id").single();if(i)throw i;const{error:F}=await S.from("papeis_pessoa").insert([{pessoa_id:u.id,papel_id:s,ativo:!0}]);if(F)throw F}await ae(),A({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),P(""),C(!1),I.success("Vendedora adicionada com sucesso!")}catch(s){console.error("Erro ao adicionar vendedora:",s),I.error((s==null?void 0:s.message)||"Falha ao adicionar vendedora")}},re=async s=>{try{const{data:n,error:u}=await S.from("pessoas").select("id, nome, dados_vendedora").eq("id",s.id).single();if(u)throw u;const i=n.dados_vendedora||{};y({id:n.id,name:n.nome,baseSalary:Number(i.salario_base||0),commissionRate:Number(i.comissao_padrao||0)/100,metaBase:Number(i.meta_mensal||0),supermetaRate:Number(i.comissao_supermeta||0)/100}),A({name:n.nome||"",baseSalary:i.salario_base?Number(i.salario_base):void 0,commissionRate:i.comissao_padrao!=null?Number(i.comissao_padrao)/100:void 0,metaBase:i.meta_mensal?Number(i.meta_mensal):void 0,supermetaRate:i.comissao_supermeta!=null?Number(i.comissao_supermeta)/100:void 0})}catch(n){console.error("Erro ao carregar vendedora:",n),I.error("Não foi possível carregar os dados da vendedora")}},W=async()=>{if(!N||!t.name.trim()){I.error("Nome é obrigatório!");return}try{const s={salario_base:t.baseSalary||null,comissao_padrao:t.commissionRate!=null?t.commissionRate*100:null,comissao_supermeta:t.supermetaRate!=null?t.supermetaRate*100:null,meta_mensal:t.metaBase||null},{error:n}=await S.from("pessoas").update({nome:t.name,dados_vendedora:s}).eq("id",N.id);if(n)throw n;c(u=>({...u,[N.id]:t.name})),y(null),A({name:"",baseSalary:void 0,commissionRate:void 0,metaBase:void 0,supermetaRate:void 0}),I.success("Vendedora atualizada com sucesso!")}catch(s){console.error("Erro ao salvar vendedora:",s),I.error("Falha ao salvar alterações")}},Z=async s=>{try{const n="e63522f6-da7e-49fe-884e-2b65b82e8456",{error:u}=await S.from("papeis_pessoa").update({ativo:!1}).eq("pessoa_id",s).eq("papel_id",n);if(u)throw u;d(i=>[...i,s]),I.success("Vendedora removida do painel!")}catch(n){console.error("Erro ao remover vendedora:",n),I.error("Não foi possível remover")}},ee=(s,n)=>{k(s,j,n)},je=(s,n)=>{E(s,j,n)},ne=()=>{if(!D){I.error("Nenhuma entidade configurada. Configure uma entidade corporativa primeiro.");return}B()};m.useEffect(()=>{const s=()=>ne();return window.addEventListener("saveAllSalesData",s),()=>window.removeEventListener("saveAllSalesData",s)},[D]);const x=s=>{const n=l.find(u=>u.id===s);n&&A(u=>({...u,name:n.nome,baseSalary:n.salario||void 0}))},b=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"Março"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}];return e.jsx("div",{className:"space-y-6",children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(L,{children:"Painel de Vendedoras"}),e.jsx(le,{children:"Gerencie informações das vendedoras, metas e comissões"})]}),e.jsxs(T,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(U,{value:j.toString(),onValueChange:s=>q(parseInt(s)),children:[e.jsx(H,{className:"w-40",children:e.jsx(K,{})}),e.jsx(X,{children:b.map(s=>e.jsx(Q,{value:s.value.toString(),children:s.label},s.value))})]}),e.jsxs(U,{value:o.toString(),onValueChange:s=>_(parseInt(s)),children:[e.jsx(H,{className:"w-32",children:e.jsx(K,{})}),e.jsx(X,{children:Array.from({length:5},(s,n)=>new Date().getFullYear()-n).map(s=>e.jsx(Q,{value:s.toString(),children:s},s))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Importar"]}),e.jsxs(w,{variant:"outline",size:"sm",children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(w,{size:"sm",onClick:ne,disabled:v||!D,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Salvar"]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:p&&p.length>0?p.filter(s=>!a.includes(s.salesperson_id)).map(s=>{var F,ve,fe,ge;const n=s.monthly_goals[j]||"",u=typeof n=="number"&&n>0?50:0,i=h[s.salesperson_id]??s.salesperson_name;return e.jsxs(Y,{children:[e.jsx(G,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-lg",children:i}),e.jsxs(le,{children:["Meta ",(F=b.find(M=>M.value===j))==null?void 0:F.label,": ",typeof n=="number"?te(n):"Não definida"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>re({id:s.salesperson_id,name:i,baseSalary:0,commissionRate:.03,metaBase:0,supermetaRate:.05}),children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>{confirm(`Tem certeza que deseja remover ${i}?`)&&Z(s.salesperson_id)},children:e.jsx(Ge,{className:"w-4 h-4"})})]})]})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsxs($,{htmlFor:`goal-${s.salesperson_id}`,className:"text-sm",children:["Meta Mensal - ",(ve=b.find(M=>M.value===j))==null?void 0:ve.label]}),e.jsx(oe,{value:typeof n=="number"?n:void 0,onValueChange:M=>ee(s.salesperson_id,(M==null?void 0:M.toString())||""),placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsxs($,{htmlFor:`sales-${s.salesperson_id}`,className:"text-sm",children:["Vendas Realizadas - ",(fe=b.find(M=>M.value===j))==null?void 0:fe.label]}),e.jsx(oe,{value:((ge=s.monthly_sales)==null?void 0:ge[j])||void 0,onValueChange:M=>je(s.salesperson_id,(M==null?void 0:M.toString())||""),placeholder:"R$ 0,00"})]})]}),e.jsx("div",{className:"flex justify-between items-center pt-2",children:e.jsxs(Le,{variant:u>=100?"default":"secondary",children:[e.jsx(Oe,{className:"w-3 h-3 mr-1"}),"Meta definida"]})})]})]},s.salesperson_id)}):e.jsx("div",{className:"col-span-full text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:v?"Carregando vendedoras...":"Nenhuma vendedora encontrada. Adicione vendedoras usando o botão abaixo."})})}),e.jsxs(be,{open:g||!!N,onOpenChange:s=>{s||(C(!1),y(null),A({name:"",baseSalary:2e3,commissionRate:.03,metaBase:15e3,supermetaRate:.05}))},children:[e.jsx(Se,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:"w-full",onClick:()=>C(!0),children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Adicionar Nova Vendedora"]})}),e.jsxs(we,{children:[e.jsxs(Ee,{children:[e.jsx(Ce,{children:N?"Editar Vendedora":"Adicionar Nova Vendedora"}),e.jsx(Re,{children:"Preencha os dados da vendedora"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"existing",children:"Selecionar Funcionário/Vendedora Existente"}),e.jsxs(U,{value:z,onValueChange:s=>{P(s),x(s)},children:[e.jsx(H,{children:e.jsx(K,{placeholder:"Escolher do cadastro existente (opcional)"})}),e.jsx(X,{children:l.map((s,n)=>e.jsxs(Q,{value:s.id,children:[s.nome," ",s.cpf?`(${s.cpf})`:""]},`${s.id}-${n}`))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"name",children:"Nome"}),e.jsx(O,{id:"name",value:t.name,onChange:s=>A(n=>({...n,name:s.target.value})),placeholder:"Digite o nome"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"baseSalary",children:"Salário Base"}),e.jsx(oe,{value:t.baseSalary,onValueChange:s=>A(n=>({...n,baseSalary:s})),placeholder:"R$ 0,00"})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"metaBase",children:"Meta Base"}),e.jsx(oe,{value:t.metaBase,onValueChange:s=>A(n=>({...n,metaBase:s})),placeholder:"R$ 0,00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"commissionRate",children:"Comissão Base (%)"}),e.jsx(me,{value:t.commissionRate?t.commissionRate*100:void 0,onValueChange:s=>A(n=>({...n,commissionRate:s?s/100:void 0})),decimals:2,min:0,max:100,placeholder:"Ex: 3.50"})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"supermetaRate",children:"Super Meta (%)"}),e.jsx(me,{value:t.supermetaRate?t.supermetaRate*100:void 0,onValueChange:s=>A(n=>({...n,supermetaRate:s?s/100:void 0})),decimals:2,min:0,max:100,placeholder:"Ex: 5.00"})]})]})]}),e.jsxs(De,{children:[e.jsx(w,{variant:"outline",onClick:()=>{C(!1),y(null),P("")},children:"Cancelar"}),e.jsx(w,{onClick:N?W:ie,children:N?"Salvar":"Adicionar"})]})]})]})]})]})})}function ls(){const[v,o]=m.useState(new Date().getFullYear()),[_,p]=m.useState(new Date().getMonth()+1),[k,E]=m.useState(5),[B]=m.useState([{month:"Jan",current:45e3,projected:47250},{month:"Fev",current:52e3,projected:54600},{month:"Mar",current:48e3,projected:50400},{month:"Abr",current:55e3,projected:57750},{month:"Mai",current:6e4,projected:63e3},{month:"Jun",current:58e3,projected:60900}]),D=new Date().getFullYear(),j=Array.from({length:5},(l,R)=>D-2+R),q=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"Março"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}],g=l=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),C=B.reduce((l,R)=>l+R.current,0),N=B.reduce((l,R)=>l+R.projected,0),y=(N-C)/C*100;return e.jsx("div",{className:"space-y-6",children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(L,{children:"Simulação de Crescimento"}),e.jsx(le,{children:"Projete cenários de crescimento baseados em dados históricos"})]}),e.jsxs(T,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"base-year",children:"Ano Base"}),e.jsxs(U,{value:v.toString(),onValueChange:l=>o(parseInt(l)),children:[e.jsx(H,{id:"base-year",children:e.jsx(K,{})}),e.jsx(X,{children:j.map(l=>e.jsx(Q,{value:l.toString(),children:l},l))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"base-month",children:"Mês Base"}),e.jsxs(U,{value:_.toString(),onValueChange:l=>p(parseInt(l)),children:[e.jsx(H,{id:"base-month",children:e.jsx(K,{})}),e.jsx(X,{children:q.map(l=>e.jsx(Q,{value:l.value.toString(),children:l.label},l.value))})]})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"growth-rate",children:"Taxa de Crescimento (%)"}),e.jsx(O,{id:"growth-rate",type:"number",value:k,onChange:l=>E(Number(l.target.value)),step:"0.1",min:"0",max:"100"})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs(w,{className:"flex-1",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Simular"]}),e.jsx(w,{variant:"outline",size:"icon",children:e.jsx(ss,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(Y,{children:e.jsxs(T,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:g(C)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vendas Atuais"})]})}),e.jsx(Y,{children:e.jsxs(T,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g(N)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Projeção com Crescimento"})]})}),e.jsx(Y,{children:e.jsxs(T,{className:"pt-6",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["+",y.toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Crescimento Projetado"})]})})]}),e.jsxs(Y,{children:[e.jsx(G,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"Comparação: Atual vs Projetado"]})}),e.jsx(T,{children:e.jsx(Ve,{width:"100%",height:300,children:e.jsxs(Ke,{data:B,children:[e.jsx(Xe,{strokeDasharray:"3 3"}),e.jsx(Qe,{dataKey:"month"}),e.jsx(We,{tickFormatter:l=>g(l)}),e.jsx(Je,{formatter:l=>g(Number(l)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(ye,{dataKey:"current",fill:"hsl(var(--muted))",name:"Atual"}),e.jsx(ye,{dataKey:"projected",fill:"hsl(var(--primary))",name:"Projetado"})]})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",children:"Aplicar Simulação"}),e.jsx(w,{variant:"outline",children:"Exportar Resultados"})]})]})]})})}function ds(){return pe(),e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(as,{}),e.jsxs(w,{onClick:()=>{window.dispatchEvent(new CustomEvent("saveAllSalesData")),console.log("Saving all sales management data...")},size:"lg",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"💾 SALVAR TODOS OS DADOS"]})]}),e.jsxs(Ue,{defaultValue:"comparison",className:"space-y-6",children:[e.jsxs(He,{className:"grid w-full grid-cols-3",children:[e.jsx(ce,{value:"comparison",children:"Comparativo Anual"}),e.jsx(ce,{value:"salespeople",children:"Vendedoras"}),e.jsx(ce,{value:"simulation",children:"Simulação"})]}),e.jsx(de,{value:"comparison",className:"space-y-6",children:e.jsx(ns,{})}),e.jsx(de,{value:"salespeople",className:"space-y-6",children:e.jsx(os,{})}),e.jsx(de,{value:"simulation",className:"space-y-6",children:e.jsx(ls,{})})]})]})}export{ds as default};
