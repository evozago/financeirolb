import{c as X,r as _,u as Z,s as S,j as e,S as P,a as B,b as F,d as R,e as z,C as h,f as x,g as p,D as Q,h as g,T as W,B as H,i as $,k as q,l as C,R as T,m as V,n as A,U as ee,o as ae}from"./index-BMWLaPCr.js";import{B as K,C as G,X as I,Y as J}from"./BarChart-D8xVrmcQ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=X("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);function te(d,v){const[f,y]=_.useState(null),[s,w]=_.useState([]),[k,b]=_.useState([]),[E,N]=_.useState([]),[D,m]=_.useState(!0),{toast:M}=Z(),u=async()=>{try{const{data:t,error:n}=await S.from("pessoas").select("id, nome, ativo, papeis").eq("ativo",!0).contains("papeis",["vendedora"]).limit(10);return!n&&t&&t.length>0?t.map(r=>({id:r.id,nome:r.nome,ativo:r.ativo})):[]}catch(t){return console.warn("Erro ao buscar vendedoras reais:",t),[]}},a=async()=>{var t,n,r;try{const{data:o,error:i}=await S.rpc("get_sales_kpi_data",{p_year:d,p_month:v});if(i){console.warn("Erro ao buscar KPI data:",i);const l=await u(),c=l.length;y({total_sales:0,total_goal:0,goal_achievement_percentage:0,mom_growth_percentage:0,yoy_growth_percentage:0,active_salespeople:c,top_performer_name:((t=l[0])==null?void 0:t.nome)||"Nenhuma vendedora encontrada",top_performer_sales:0});return}if(o&&o.length>0)y(o[0]);else{const l=await u();y({total_sales:0,total_goal:0,goal_achievement_percentage:0,mom_growth_percentage:0,yoy_growth_percentage:0,active_salespeople:l.length,top_performer_name:((n=l[0])==null?void 0:n.nome)||"Nenhuma vendedora encontrada",top_performer_sales:0})}}catch(o){console.warn("Erro ao buscar KPI data:",o);const i=await u();y({total_sales:0,total_goal:0,goal_achievement_percentage:0,mom_growth_percentage:0,yoy_growth_percentage:0,active_salespeople:i.length,top_performer_name:((r=i[0])==null?void 0:r.nome)||"Nenhuma vendedora encontrada",top_performer_sales:0})}},j=async()=>{try{const t=await u(),{data:n,error:r}=await S.rpc("calculate_mom_growth",{p_year:d,p_month:v});if(r||!n||n.length===0){console.warn("Erro ao buscar dados MoM:",r);const l=t.map((c,Y)=>({vendedora_id:c.id,vendedora_nome:c.nome,current_sales:0,previous_sales:0,growth_percentage:0}));w(l)}else w(n);const{data:o,error:i}=await S.rpc("calculate_yoy_growth",{p_year:d,p_month:v});if(i||!o||o.length===0){console.warn("Erro ao buscar dados YoY:",i);const l=t.map((c,Y)=>({vendedora_id:c.id,vendedora_nome:c.nome,current_sales:0,previous_year_sales:0,growth_percentage:0}));b(l)}else b(o)}catch(t){console.warn("Erro ao buscar dados de crescimento:",t);const r=(await u()).map(o=>({vendedora_id:o.id,vendedora_nome:o.nome,current_sales:0,previous_sales:0,growth_percentage:0}));w(r),b(r)}},L=async()=>{try{const{data:t,error:n}=await S.from("sales_monthly_summary").select("ano, mes, total_vendas, meta_mensal").eq("ano",d).order("mes"),r=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];if(n||!t||t.length===0){console.warn("Erro ao buscar dados mensais:",n);const i=r.map(l=>({mes:l,vendas:0,meta:0}));N(i);return}const o=r.map((i,l)=>{const c=t.find(U=>U.mes===l+1),Y=c?Number(c.total_vendas||0):0,O=c?Number(c.meta_mensal||0):0;return{mes:r[l],vendas:Y,meta:O}});N(o)}catch(t){console.warn("Erro ao buscar dados mensais:",t);const r=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"].map(o=>({mes:o,vendas:0,meta:0}));N(r)}};return _.useEffect(()=>{(async()=>{m(!0);try{await Promise.all([a(),j(),L()])}catch(n){console.error("Erro geral ao buscar dados:",n),M({title:"Aviso",description:"Dados de vendas não configurados. Configure vendedoras e metas no sistema.",variant:"default"})}finally{m(!1)}})()},[d,v]),{kpiData:f,momGrowthData:s,yoyGrowthData:k,monthlySalesData:E,loading:D}}function ne(){var M,u;const[d,v]=_.useState(new Date().getFullYear()),[f,y]=_.useState(new Date().getMonth()+1),{kpiData:s,momGrowthData:w,yoyGrowthData:k,monthlySalesData:b}=te(d,f),E=new Date().getFullYear(),N=Array.from({length:5},(a,j)=>E-j),D=[{value:1,label:"Janeiro"},{value:2,label:"Fevereiro"},{value:3,label:"Março"},{value:4,label:"Abril"},{value:5,label:"Maio"},{value:6,label:"Junho"},{value:7,label:"Julho"},{value:8,label:"Agosto"},{value:9,label:"Setembro"},{value:10,label:"Outubro"},{value:11,label:"Novembro"},{value:12,label:"Dezembro"}],m=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a);return e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard de Vendas"}),e.jsx("p",{className:"text-muted-foreground",children:"Acompanhe o desempenho das vendas e metas mensais"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{value:f.toString(),onValueChange:a=>y(parseInt(a)),children:[e.jsx(B,{className:"w-40",children:e.jsx(F,{})}),e.jsx(R,{children:D.map(a=>e.jsx(z,{value:a.value.toString(),children:a.label},a.value))})]}),e.jsxs(P,{value:d.toString(),onValueChange:a=>v(parseInt(a)),children:[e.jsx(B,{className:"w-32",children:e.jsx(F,{})}),e.jsx(R,{children:N.map(a=>e.jsx(z,{value:a.toString(),children:a},a))})]})]})]}),s&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Vendas do Mês"}),e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m(s.total_sales)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Meta: ",m(s.total_goal)]})]})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Atingimento da Meta"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[s.goal_achievement_percentage,"%"]}),e.jsx(H,{variant:s.goal_achievement_percentage>=100?"default":"secondary",children:s.goal_achievement_percentage>=100?"Meta atingida":"Abaixo da meta"})]})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Crescimento MoM"}),s.mom_growth_percentage>=0?e.jsx($,{className:"h-4 w-4 text-green-600"}):e.jsx(q,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:`text-2xl font-bold ${s.mom_growth_percentage>=0?"text-green-600":"text-red-600"}`,children:[s.mom_growth_percentage>0?"+":"",s.mom_growth_percentage,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs mês anterior"})]})]}),e.jsxs(h,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Crescimento YoY"}),s.yoy_growth_percentage>=0?e.jsx($,{className:"h-4 w-4 text-green-600"}):e.jsx(q,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(g,{children:[e.jsxs("div",{className:`text-2xl font-bold ${s.yoy_growth_percentage>=0?"text-green-600":"text-red-600"}`,children:[s.yoy_growth_percentage>0?"+":"",s.yoy_growth_percentage,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"vs ano anterior"})]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsxs(p,{children:["Vendas vs Meta - ",d]}),e.jsx(C,{children:"Acompanhamento mensal das vendas realizadas versus metas estabelecidas"})]}),e.jsx(g,{children:e.jsx(T,{width:"100%",height:300,children:e.jsxs(K,{data:b,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"mes"}),e.jsx(J,{tickFormatter:a=>m(a)}),e.jsx(V,{formatter:a=>m(Number(a)),labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(A,{dataKey:"vendas",fill:"hsl(var(--primary))",name:"Vendas"}),e.jsx(A,{dataKey:"meta",fill:"hsl(var(--muted))",name:"Meta"})]})})})]}),e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsxs(p,{children:["Top Vendedoras - ",(M=D.find(a=>a.value===f))==null?void 0:M.label," ",d]}),e.jsx(C,{children:"Ranking das melhores performances do mês"})]}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:w.slice(0,5).map((a,j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${j===0?"bg-yellow-100 text-yellow-800":j===1?"bg-gray-100 text-gray-800":j===2?"bg-orange-100 text-orange-800":"bg-muted text-muted-foreground"}`,children:j+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.vendedora_nome}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m(a.current_sales)})]})]}),e.jsxs(H,{variant:a.growth_percentage>=0?"default":"secondary",children:[a.growth_percentage>0?"+":"",a.growth_percentage,"%"]})]},a.vendedora_id))})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(p,{children:"Crescimento Mês vs Mês"}),e.jsx(C,{children:"Performance comparativa com o mês anterior"})]}),e.jsx(g,{children:e.jsx(T,{width:"100%",height:300,children:e.jsxs(K,{data:w.slice(0,8).map(a=>({...a,color:a.growth_percentage>=0?"hsl(var(--primary))":"hsl(var(--destructive))"})),children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"vendedora_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(J,{}),e.jsx(V,{formatter:a=>[`${a}%`,"Crescimento"],labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(A,{dataKey:"growth_percentage",fill:"hsl(var(--primary))",name:"Crescimento %"})]})})})]}),e.jsxs(h,{children:[e.jsxs(x,{children:[e.jsx(p,{children:"Crescimento Ano vs Ano"}),e.jsx(C,{children:"Performance comparativa com o mesmo mês do ano anterior"})]}),e.jsx(g,{children:e.jsx(T,{width:"100%",height:300,children:e.jsxs(K,{data:k.slice(0,8).map(a=>({...a,color:a.growth_percentage>=0?"hsl(var(--primary))":"hsl(var(--destructive))"})),children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"vendedora_nome",angle:-45,textAnchor:"end",height:100}),e.jsx(J,{}),e.jsx(V,{formatter:a=>[`${a}%`,"Crescimento"],labelStyle:{color:"hsl(var(--foreground))"}}),e.jsx(A,{dataKey:"growth_percentage",fill:"hsl(var(--primary))",name:"Crescimento %"})]})})})]})]}),s&&e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(p,{children:"Insights Principais"})}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(se,{className:"h-8 w-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Top Performer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.top_performer_name}),e.jsx("p",{className:"text-sm font-medium",children:m(s.top_performer_sales)})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(ee,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Vendedoras Ativas"}),e.jsx("p",{className:"text-2xl font-bold",children:s.active_salespeople}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"participaram das vendas"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(ae,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Período"}),e.jsxs("p",{className:"text-sm font-medium",children:[(u=D.find(a=>a.value===f))==null?void 0:u.label," ",d]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"dados atualizados"})]})]})]})})]})]})}export{ne as default};
